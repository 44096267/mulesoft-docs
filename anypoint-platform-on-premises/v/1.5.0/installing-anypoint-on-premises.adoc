= Installing Anypoint Platform On Premises Edition
:keywords:anypoint platform, on premises


== Overview

The Anypoint Platform On-Premises Edition offers all of the features that are available in the online version of the link:https://anypoint.mulesoft.com[Anypoint Platform] as a service that you can run on your local servers, guarded by any security policies you may require. This document guides you through the installation process.



== Prerequisites

https://docs.google.com/document/d/1JiAw5w4rYzufbnQgCU2-tD4uDYwjzRZE8_C3dhIvwbg/edit#heading=h.bgd2c28sfii2


== Running the Installer Wizard

The installation wizard automatically configures most of the infrastructure that you need to run the Anypoint Platform On-premises, including Kubernetes and the deployment of Docker containers on this infrastructure.



. Download the installation package from support portal ???
. From the command line, run the command  `gravity install`  (consultar a Palbo syntaxis exacta del comando)
+
This will open the wizard
. ponerle un nombre,
. pegar licencia (contact your sales rep)
. seleccionar Manual  (borrar las otras dos opciones linux y queseyo en screnshot)
. copiar el codigo en cada uno de tus servidores  (tus servidores tienen q tener Redhad 7.2)
. te pide un mail un usuario y una clave




Dps de correr instalacion, correr CURL command para crear organization,  only then te podes loguear al platform  (esto lo hará sólo el installer de gravitational o es a parte??)

image:install-onprem-6134f.png[]

----
curl -s --tlsv1.2 "https://mulesoft.gravitational.io:443/t/501272306637c19857ec3f5f549d858e/node?state_dir=xvdb&devicemapper=xvdc
----


Once the installation is complete, you're prompted to choose if you want to have your platform exposed through the Operatins Center. The default option is No

...what is the ops center


== Configure Log Forwarding

[NOTE]
This section refers to forwarding log data from the Anypoint Platform itself. For instructions on how to forward log data from the Mule servers and applications that run on the platform, see link:/runtime-manager/sending-data-from-arm-to-external-monitoring-software[Sending data from Runtime Manager to External Monitoring Software].


The Anypoint Platform uses rsyslog for handling its logging. Forwarding these logs to remote hosts can be set up in 3 different ways:

* *On the Anypoint Platform Ops Center* (if you enabled the Operations Center)
. Enter the ops center
. Go to *Logs* > *Settings*
+
image:installing-anypoint-on-premises-logs1.png[logs]
. Set the Address on your network where the external software (eg Splunk) resides
+
image:installing-anypoint-on-premises-logs2.png[logs]


* /forwarders endpoint of the log-collector service
* Kubernetes extra-log-collector-config ConfigMap


[NOTE]
It's assumed that you're forwarding your logs to an on-premises log solution, like Splunk. It's not supported to send data to a cloud-based log solution, like Splunk Cloud.

== Create a Load Balancer

You'll likely want to install the Anypoint Platform distributed amongst multiple servers. To support this, you must provide your own load balancer to distribute the traffic between them. You can use any standard tool for creating this load balancer, like nginx. Even if you plan to deploy the platform to a single server, a load balancer is strongly recommended to restrict the ports that are open to just the necessary ones.

////
(diagrama de lucidchart) ???
////

You can configure this load balancer with any strategy you want, but a *round robin* strategy is most often the ideal.

Your load balancer must route the following TCP ports:

[%header%autowidth.spread]
|===
|Load Balancer Port |Instance Port | Internal Usage
|`80` | `30080`  | internal nginx redirects to `443`.
|`443` | `30443` | internal nginx does a proxy pass to the corresponding micro-service in kubernetes.
|`8889` | `30889` | internal nginx does TCP forwarding to `cloudhub-mcm`.
|`9500` | `30081` | internal nginx does a proxy pass to the `gravity-site` kubernetes service.
|`9501` | `30082` | internal nginx does a proxy pass to the `grafana` kubernetes service.
|===

In every case, your load balancer must listen on the *Load Balancer Port* and redirect incoming requests to the *Instance Port*. Your installation of the Anypoint Platform includes an internal nginx server that listens on each of the *Instance Ports* and then does what's described in *Internal Usage*.


[NOTE]
To configure SSL, you don't need to set this up in your load balancer. You can configure that via the Anypoint Platform UI, see <<section>> or link:/access-management/  ???


== Set up SMTP

UI od the platform??

link:/access-management/  etc  ??

== Certificates ???

== Handling Third Party Authentication

link:/access-management/  etc  ??

LDAP
