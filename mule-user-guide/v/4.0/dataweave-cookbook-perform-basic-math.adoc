= Example: Perform Basic Math
:keywords: studio, anypoint, transform, transformer, format, xml, metadata, dataweave, data weave, datamapper, dwl, dfl, dw, output structure, input structure, map, mapping

This example takes in a set of item prices and stock amounts and uses several functions to calculate subtotals, deduct discounts and add taxes.

It makes use of the following:

* `map` function to go through all the items in the input.
* `@` to insert an "index" attribute to the XML output.
* basic math operations like `*`, `+` and `-`.
* String concatenation with `++`.
* `as` to force string values into numbers.
* Fixed values in the header to set tax and discount amounts.
* A custom function in the header, to define once and use multiple times in the code.
* `reduce` function to aggregate the various items into a total.


.DataWeave
[source,Dataweave,linenums]
----
%dw 1.0
%output application/xml
%var tax = 0.085
%var discount = 0.05
%function getSubtotal (items) = items reduce ((item, accumulator = 0) ->
        accumulator + (item.unit_price * item.quantity * (1 - discount)))
---
invoice: {
    header: payload.invoice.header,
    items: { (payload.invoice.items map {
        item @(index: $$ + 1): {
            description: $.description,
            quantity: $.quantity,
            unit_price: $.unit_price,
            discount: (discount * 100) as Number { format: "##" } ++ "%",
            subtotal: $.unit_price * $.quantity * (1 - discount)
        }
    }) },
    totals:
    {
        subtotal: getSubtotal(payload.invoice.items ),
        tax: (tax * 100) as Number { format: "##.#" } ++ "%",
        total: getSubtotal(payload.invoice.items ) * (1 + tax)
    }
}
----

.Input JSON
[source,json,linenums]
----
{
  "invoice": {
    "header": {
      "customer_name": "ACME, Inc.",
      "customer_state": "CA"
    },
    "items": [
      {
        "description": "Product 1",
        "quantity": "2",
        "unit_price": "10"
      },
      {
        "description": "Product 2",
        "quantity": "1",
        "unit_price": "30"
      }
    ]
  }
}
----

.Output XML
[source,xml,linenums]
----
<?xml version='1.0' encoding='US-ASCII'?>
<invoice>
  <header>
    <customer_name>ACME, Inc.</customer_name>
    <customer_state>CA</customer_state>
  </header>
  <items>
    <item index="1">
      <description>Product 1</description>
      <quantity>2</quantity>
      <unit_price>10</unit_price>
      <discount>5.00%</discount>
      <subtotal>19.00</subtotal>
    </item>
    <item index="2">
      <description>Product 2</description>
      <quantity>1</quantity>
      <unit_price>30</unit_price>
      <discount>5.00%</discount>
      <subtotal>28.50</subtotal>
    </item>
  </items>
  <totals>
    <subtotal>47.50</subtotal>
    <tax>8.500%</tax>
    <total>51.53750</total>
  </totals>
</invoice>
----


== See Also

link:/mule-user-guide/v/4.0/dataweave-types[DataWeave Value Types]

link:/mule-user-guide/v/4.0/dataweave-operators[DataWeave Operators]

link:/mule-user-guide/v/4.0/dataweave-selectors[DataWeave Selectors]

link:/mule-user-guide/v/4.0/dataweave-examples[DataWeave Examples]
