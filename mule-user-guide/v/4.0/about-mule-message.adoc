= Mule Message Structure
:keywords: studio, components, elements, message, mule message, architecture

// COMBAK: Review for Beta, when batch job is allowed
// [NOTE]
// This document examines the Mule message in the context of a flow rather than a batch job. Please see link:/mule-user-guide/v/3.8/batch-processing[Batch Processing] for more information about how messages in a batch job are broken up and processed as records.

////
Removing:
The Mule message is the data that passes through flows inside your Mule application.
////

A Mule message carries a payload and any attributes through a flow in a Mule app. Connector operations receive and return Mule messages. For example, when an HTTP Listener in a Mule app receives an HTTP request, it creates a Mule message that contains the HTTP body as the payload. The attributes of the message contain the incoming HTTP headers and any metadata populated by the connector.

image::mule-message-structure-82af1.png[mule-message-structure-82af1]

// REVIEW: Batch jobs are not available in Mozart. No need to mention this until Mule 4 releases
// [NOTE]
// Large messages or streaming messages can be processed as records in a batch job.

== Message Payload

The message payload is the body of a Mule message. For example, the payload contains the content of records you retrieve through the Select operation of the Database connector or the content of a file that you retrieve through a Read operation to the File or FTP connector.

* `payload`: You access the payload through the keyword `payload` from a connector or component in your flow, and you can use DataWeave selectors, such as `payload.someField` to access fields within the payload.

Message processors in your flow, such as the Transform component, can use DataWeave to modify the message payload that the processor outputs. These modifications include changing the set of fields to output or changing the format of the data. For example, you might change the format from XML to JSON. You might exclude a field that contains personal identifiers or private data for a customer, such as the social security or medical record number, or you might add a new field to the output.

The payload typically changes as it travels through a flow as message processors in a Mule flow set it, enrich it, or transform it into a new format. You can also extract information from a payload within a flow using a DataWeave expression and storing it as a variable.

////
Linking out to Set Payload from this page instead.
Setting a Message Payload

Use a Set Payload component to completely replace the content of the message’s payload. Enter a literal string or a Data Weave expression that defines the new payload that Mule should set. The following example replaces the payload with a string that reads "Hello, my friend!".
////

//
// // REVIEW: Update this set payload example using Mule 4 sytanx
// [source, xml, linenums]
// ----
// include::_sources/mule-message-structure_2.xml[]
// ----

== Attributes

Attributes contain message metadata consisting potentially both headers or properties recieved or returned by the connector as well as other meta-data populated by the connector. Exactly what meta-data is available to is dependent on the connector.

You access attributes through the keyword `attributes` of a message, such as a file you are reading or an HTTP response, when using a connector or component, such as the Logger, in your flow.

* File metadata examples:
** `attributes.fileName`: For getting the name of a file, such as `myFile.json`.
** `attributes.size`: For getting the size of a file, such as `1079.`
* HTTP header examples:
** `attributes.statusCode`: For getting the HTTP status code, such as `200`.
** `attributes."content-type"`: For getting the HTTP content type, such as `application/json; charset=utf-8`.

Note that the quotation marks in `attributes."content-type"` are necessary to avoid a parsing error. The only valid identifiers for attribute names are numbers, characters, and underscores. Without the quotation marks, the name is parsed like this `attributes.content - type`.

// TODO: MOVE TO A PROCEDURE OR FIND THIS IN FER'S STUDIO DOC.

In Anypoint Studio, the DataSense explorer shows the structure of a Mule message at any given point of the flow. It displays both the structure of the message that enters the element and the structure of the message that leaves it. This is useful for discovering the names of variables and attributes that are available at that point and for seeing the payload's internal structure.

////
All you have to do is select an element in the flow and click the DataSense icon.

image:datasenseexplorericon.png[icon]

This opens the DataSense explorer, and displays both the structure of the message that enters the element, and the structure of the message that leaves it. This is useful to know the names of variables and attributes that are available at that point, as well as the payload's internal structure.
////

image:metadata-explorer.png[metadata]

It is important to note that when the Mule Message relies on inbound requests, Studio does not have information about the initial message structure, so it does not display it in the DataSense explorer. However, if you know what the structure needs to be like, you can input this information into the Metadata tab of the inbound connector. Then DataSense explorer can infer the message structure for any of the elements that follow that input.

////
TODO: BROKEN LINK
For more information, see link:/anypoint-studio/v/6/using-the-datasense-explorer[using the DataSense Explorer]
////

== See Also

* link:/mule-user-guide/v/4.0/about-mule-event[About the Mule Event]
* link:/mule-user-guide/v/4.0/dataweave[About DataWeave]
* link:/mule-user-guide/v/4.0/set-payload-transformer-reference[Set Paylaod]
