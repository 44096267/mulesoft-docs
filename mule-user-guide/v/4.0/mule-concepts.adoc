= Key Concepts
:keywords: studio, server, components, connectors, elements, big picture, architecture
:imagesdir: ./_images
:toc: macro
:toc-title:
:toclevels: 1

// TODO/QUESTION: NOT CLEAR IS SOME OF THIS ONLY APPLIES TO STUDIO, AND NOT DESIGN CENTER, OR IF IT IS OUT OF DATE FOR 4.0, OR IF THEY ARE NOT YET IN DESIGN CENTER (OR STUDIO). EXAMPLES: ROUTING, ASYNC, VARIOUS TRANSFORMERS (AS OPPOSED TO THE ONE TRANSFORMER)

//TODO/QUESTION DUKE: DOES THIS NEED ITS OWN HEADING SINCE THE TITLE OF THE PAGE IS "Key Concepts". If you hit this page from search, you might not know we are in the "Mule Runtime" section. More importantly, you are very likely to need to understand concepts here even if you are not trying to understand Mule Runtime.
// TODO: "powers" sounds like marketing speak
Mule runtime is the engine that powers Mule applications.
The runtime defines the rules for how event data is handled in an application.


== Mule Event

A *Mule event* is an object containing the core information processed by the runtime. It travels through *Components* inside your Mule application following the configured application logic.

[NOTE]
Do not confuse the event that triggers a Mule application with the Mule event. The Mule event is created in response to the external event.

A Mule event is generated by the *Event source* of a flow, which is configured to be triggered by a _resource_ that might be external to the Mule Runtime, such as an HTTP request, or a change to a database or file.

image::mule-concepts-75c78.png[mule-concepts-75c78]

. An *external event* triggers the *event source*.
. The event source produces a *Mule event* object.
. The Mule event travels sequentially through the components of a *flow*.
. Each component interacts in a pre-defined manner with the Mule event.

A *Mule Event* composed of:
// TODO: WHY DO WE DEFINE THESE IN MORE THAN ONE PLACE ON THIS PAGE?
* A *payload* with the main data that the mule application processes.
* A collection of *Attributes* with metadata about the message's payload.
* *Variables*, which are pieces of information about the *Mule Event* meant to be used by the application that is processing it.


=== See Also

* link:/#mule-message[Mule Message]
* link:/#event-source[Event Source]
* link:/#event-processor[Event Processor]
* link:/#variables[Variables]


=== Mule Message

// TODO DUKE: WHAT DOES "the core business information" mean or add to this description.
// TODO DUKE: WHY DO WE DEFINE ATTRIBUTES AND PAYLOAD AGAIN HERE?
Mule message is the core business information of a Mule event, and is composed of a *payload* - the most important data of the Mule event, and *attributes*, which are metadata for the message payload.

// TODO DUKE: WHY IS A NOTE NEEDED HERE? IT COULD EASILY BE JUST ANOTHER PLAIN OLD SENTNCE IF IT'S NEEDED HERE. I'M NOT SURE WHAT EXACTLY TO DO WITH THAT INFO EITHER, BUT WHATEVER.
[NOTE]
Large messages or streaming messages can be processed as *records* in a *batch job*.

=== See Also

* <<Payload>>
* <<Attributes>>



==== Payload
// TODO DUKE: WHAT IS A CUSTOMER SUPPOSED TO THINK THIS MEANS OTHER THAN THAT THE PAYLOAD IS REALLY IMPORTANT? WHY IS IT IMPORTANT? WHAT MAKES IT THE "CORE INFO"?
The *payload* is the core information of a *Mule message* containing the core data to be processed in the Mule flow.


==== Attributes

//TODO: are attributes accessible from the application?
//TODO DUKE: THIS TIP COULD EASILY BE TURNED INTO A "FOR EXAMPLE" SO I HAVE SOME CONTEXT FOR UNDERSTANDING WHAT THIS MEANS, SINCE ALL I KNOW IS THAT THE PAYLOAD IS THE CORE INFORMATION. SO THIS IS METADATA FOR THE CORE INFORMATION FOR A MULE MESSAGE.
The *attributes* are _metadata_ for the *payload*.

[TIP]
Sending a _POST_ HTTP Request with an XML file to a Mule application generates a *Mule Message* whose *attributes* are the HTTP headers, and its *payload* is the XML file being POSTed.

=== Variables

// TODO: Require more context around variables.
// TODO DUKE: "In Mule terms"? JUST SAY THAT Mule variables do x, y, or z. Or that in Mule, variable do x, y, or z.
// TODO DUKE: "in your application" --> "in a/your Mule application"?
// TODO DUKE: IS "MULE APPLICATION" DEFINED ANYWHERE?
In Mule terms, variables are used to hold metadata for the Mule event. These can be defined and referenced in your application.

// TODO DUKE: WORDING OR GRAMMAR HERE IS STRANGE. "to a processing Mule event"?
Variables can store metadata resulting from different *operations* performed throughout the application or to add metadata to a processing *Mule event*.

// TODO: Would it make sense to show Event Context (ExecutionContext) ?
// === Event Context
//The ExecutionContext that does not change within the scope of a single request and has the orginalPayload, MEP, credentials as well as reference to txContext and muleContext.

== Component
// TODO DUKE: ARE THEY THE BUILDING BLOCKS OF A MULE APP USED TO PROCESS MULE EVENTS IN SPECIFIC WAYS. FOR EXAMPLE...? Saying that they "determine their logic to process the Mule event" seems unnecessary. Also makes me have to read it a couple times to make sure I'm not missing some nuanced point.
Mule uses *components* to _compose_  Mule applications and determine their logic to process the *Mule event*.

The generic categories of *components* in a Mule application are:

* <<Flow>>
* <<Event Source>>
* <<Event Processor>>

// TODO DUKE: THAT COMMENT ABOUT A FLOW BEING A COMPONENT MIGHT MAKE MORE SENSE IF PEOPLE UNDERSTOOD THAT THERE CAN BE MORE THAN ONE FLOW IN A PROJECT OR SOMETHING LIKE THAT, WHICH IS PROBABLY IMPORTANT TO UNDERSTAND.
// TODO: SEEMS
=== Flow

// TODO DUKE: BUT THE SECTION JUST DID REFER TO A FLOW AS SUCH UNDER THE CONCEPT "COMPONENT"
A flow is a sequence of components that handle the *Mule Event*. A flow itself can be thought of as a component, but typically we don't refer to a flow as such.

// TODO DUKE: THE "elements" we referring to ARE components? Not clear what that's supposed to mean.
When you link together several individual elements to handle the receipt, processing, and eventual routing of a *Mule Event* you are essentially composing a flow.

// TODO DUKE: WHY ARE WE EXPLAINING THE EVENT SOURCE AND THE MULE EVENT HERE? WE DISCUSSED THEM ALREADY ELSEWHERE. WHAT ABOUT THE FACT THAT FLOWS CAN BE REFERENCED BY OTHER FLOWS? ETC. WHAT ELSE COULD START A FLOW BESIDES AN EVENT SOURCE, AS SEEMS TO BE IMPLIED HERE.
Typically, a *flow* starts with an event source. When the event source is triggered, a *Mule event* is created.

// TODO: WHY ARE WE TALKING ABOUT WHAT EVENT PROCESSORS DO? WE ALREADY DESCRIBED THEM ELSEWHERE.
Then, event Processors transform, enrich and filter the Mule event.

=== See Also

* <<Event Source>>
* <<Event Processor>>


// TODO: TERMINOLOGY RANT - Hate the word "Event Source". Too easy to conflate with the event that triggers a flow, rather than the component that listens, polls, watches for, etc. a triggering event that is used to instantiate a mule event object. In Design Center, they're actually called Triggers, right? To me, the term "event source" does not sound like a Mule component. It sounds like the event that triggers a flow, rather than a Mule component that handles that triggering event. This is probably why for "Mule Event" you have to say "Do not confuse the event that triggers a Mule application with the Mule event. The Mule event is created in response to the external event." Because the use of "event" and "source" in Mule-ese is strange.
=== Event Source

An *Event Source* waits for an event that triggers it. The Event Source performs logic to define a corresponding Mule Event object. It then forwards this object to the next <<Component>> in the flow.

Examples of *event sources*:

* *HTTP Listener*
* *File Directory Watcher*
// Nit: Isn't Poll an "Event Source", and if so, doesn't it really trigger events itself, rather than waiting for an event to trigger it?

=== See Also

* <<Module>>


=== Event Processor
// TODO/DUKE: ARE SCOPES AND ROUTERS going to be available in Design Center?
// TODO/DUKE: KIND OF WORDY HERE. THE TERM "EVENT PROCESSOR" IS SORT OF SELF EXPLANATORY, SO YOU COULD PROBABLY CUT OUT THE EXPLANATION THAT THE PROCESSOR PROCESSES STUFF ACCORDING TO SOME LOGIC. THAT'S PROBABLY UNDERSTOOD. UNDERSTANDING THAT THERE ARE DIFFERENT TYPES OF EVENT PROCESSORS IS MORE HELPFUL. PROBABLY NO ONE NEEDS TO HEAR ABOUT THE BACKEND.
Event Processors are the components used to conduct backend processes for specific business logic around the *Mule event*.

They are grouped based on the actions they facilitate:

* <<Operation>>
* <<Scope>>
* <<Router>>
* <<Transformer>>
* <<Module>>


==== Operation
// TODO/DUKE:  OPERATIONS NOW SEEM TO BE SEPARATE FROM THE CONNECTOR, IN THE SENSE THAT THEY ARE ACTIONS THAT THE CONNECTOR CAN TAKE, LIKE METHODS IN A CLASS. WONDER IF "operations" and "operators" are going to get conflated. We talk about the FTP connector, singular, not the FTP Connectors.
// TODO: "They can be use to ..." These are just examples, right. That's not all they can do, right? Leave no doubt that they can do more than that.
*Operations* apply specific actions in the Mule application. They can be used to generate a request to an external source, or to point to local resources within an application's package structure.

// TODO/DUKE: HUH? The Database connector is not an operation, is it? It actually supports a number of operations: Bulk Delete, Delete, Insert, etc.
Examples of *operations* are any connectors that are supported by a module, like the Database Connector. Most connectors are now based on the operation model.

=== See Also

* link:/#module[Module]


==== Scope
// TODO/DUKE: IN 4.0, EITHER THAT WRAPPING IS OPAQUE TO THE USER, OR IT ISN'T HAPPENING JUST YET. IS THIS GOING TO BE SUPPORTED IN DESIGN CENTER OR STUDIO IN 4.0? NIT: FOR 4.0, FIRST SENTENCE MAKES IT SOUND LIKE A CONNECTOR COULD BE A SCOPE, BUT I DON'T THINK THAT'S WHAT'S INTENDED.
*Scopes* can wrap a group of *operations* within a *flow* to define a fine-grained behavior for them to apply. They can be used to define the frequency at which to perform an operation, or to specify that a certain group of *operations* should be applied asynchronously.

// TODO/DUKE: IS ASYNC GOING TO BE IN 4.0? NOT THERE YET.
// TODO: is async a scope or a router?
Some examples of scopes are *Poll* and *Async*.

//TODO: Can I use a scope to enrich a message payload?

// TODO/DUKE: IS ROUTER GOING TO BE IN 4.0? NOT THERE YET. SEEMS LIKE WE COULD ADD  A CONCRETE EXAMPLE.
==== Router

*Routers* can be used to direct, resequence, split and aggregate Mule events.

Some examples of routers are _Splitter_, _Scatter-gather_ and _Resequencer_.

==== Transformer
// TODO/DUKE: NEED MORE DETAIL. HOW CAN CHANGE IT THE CONTENTS?
A transformer is a *component* that changes the contents of the *Mule event*.
// THESE ARE NOT ON MULE 4.0. WILL THEY BE? CONFUSING BC THESE ARE TRANSFOMERS, NOT THE TRANSFORMER.
Some examples of *transformers* are _Object to XML_ and the _Object to String_ transformers.

// TODO/NOTE: CONFUSING: TRANSFORMERS VS. TRANSFORMER. ARE THEY REALLY GOING TO REMOVE TRANSFORMERS EVEN TEMPORARILY IN 4.0? ONLY THE TRANSFORMER COMPONENT IS IN DESIGN CENTER. MAYBE STUDIO IS DIFFERENT?
[CAUTION]
Transformers are included in Mule 4 Beta for compatibility reasons. They will be deprecated for future releases. +
Transformations should be carried out through DataWeave expressions in the Transform component.

// TODO/DUKE: ARE THESE THIRD PARTY THINGS? EXTENSIONS? OR OTHERWISE SOMETHING IN ADDITION TO THE STANDARD OFFERINGS?
==== Module

A module is a package of functionality for Mule. It can combine *Event sources*, perform *operations* and offer a number *configurations*, each of which may support a subset of operations.

Each *Module* can extend the runtime capabilities allowing users to configure connections to different services almost automatically.

// TODO: Modules to use to validate

// TODO: Determine if this is technically accurate
Importantly, *modules* don't have to have any Mule-specific code; they can simply be POJOs, Spring beans, Java beans, Groovy scripts, or web services containing the business logic for processing data. Components can even be developed in other languages such as Python, JavaScript, Ruby, and PHP. Mule’s catalog of *components* support the most commonly used Enterprise Integration Patterns.

Some examples of *modules* are the _SalesForce Connector_ and the _SAP Connector_.

// TODO/DUKE: THERE ARE OTHER CONFIGS, SUCH AS OPERATION CONFIGS, AT LEAST IN DESIGN CENTER.
==== Configurations

Global configurations for a specific *module* are typically defined for a connector

// TODO/DUKE: DW DESCRIBED IN SEVERAL PLACES. FIGURE OUT WHERE TO PUT THE INFO.
== DataWeave

Dataweave is the primary language used for formulating expressions in Mule, allowing you to access, manipulate, and use information from the message and its environment. 

At runtime, Mule evaluates expressions while executing a flow to:

* Extract information from the Mule event.
* Restructure or manipulate any part of the Mule event.
// TODO: Define if DW can be used to filter muleEvents.
* Define a filter, to allow certain *Mule events* to continue to be processed in a *flow* based on certain criteria.
* Set or manipulate a value in the message attribute, the payload, or a variable.
* Perform an operation on information in the Mule event, application, Mule instance, or server.
