= Example: Defining a Function that Flattens Data in a List
:keywords: studio, anypoint, transform, transformer, format, aggregate, rename, split, filter convert, xml, json, csv, pojo, java object, metadata, dataweave, data weave, datamapper, dwl, dfl, dw, output structure, input structure, map, mapping

When presented with nested lists of data, you might need to reduce (or "flatten") the data in them to produce a simpler output. This example flattens the data in the `interests` and `contenttypes` arrays with the function that is defined in the header, and it only outputs `contenttypes` if it is not empty.

The example uses these Dataweave operators:

* `map` to map whole set of elements in the input
* `reduce` to flatten two separate arrays, `interests` and `contenttypes`
* `when` to conditionally display the last field, `contenttypes`
* `splitBy` to parse the input

== JSON Input
.Input
[source,json, linenums]
----
{
  "results": [
    {
      "profile": {
        "firstName": "john",
        "lastName": "doe",
        "email": "johndoe@demo.com"
      },
      "data": {
        "interests": [
          {
            "language": "English",
            "tags": [
              "digital-strategy:Digital Strategy",
              "innovation:Innovation"
            ],
            "contenttypes": []
          }
        ]
      }
    },
    {
      "profile": {
        "firstName": "jane",
        "lastName": "doe",
        "email": "janedoe@demo.com"
      },
      "data": {
        "interests": [
          {
            "language": "English",
            "tags": [
              "tax-reform:Tax Reform",
              "retail-health:Retail Health"
            ],
            "contenttypes": [
              "News",
              "Analysis",
              "Case studies",
              "Press releases"
            ]
          }
        ]
      }
    }
  ],
  "objectsCount": 2,
  "totalCount": 2,
  "statusCode": 200,
  "errorCode": 0,
  "statusReason": "OK"
}
----

.DataWeave
[source,dataweave,linenums]
----
%dw 1.0
%output application/json
%function reduceMapFor(data) data reduce (($$ splitBy ":")[0] ++ "," ++ ($ splitBy ":")[0])
---
payload.results map
{
  email: $.profile.email,
  name: $.profile.firstName,
	tags: reduceMapFor($.data.interests.tags[0]),
	(contenttypes: reduceMapFor($.data.interests.contenttypes[0])) when (sizeOf($.data.interests.contenttypes[0])) > 0
}
----

== JSON Output
.Output
[source,json,linenums]
----
[
  {
    "email": "johndoe@demo.com",
    "name": "john",
    "tags": "digital-strategy,innovation"
  },
  {
    "email": "janedoe@demo.com",
    "name": "jane",
    "tags": "tax-reform,retail-health",
    "contenttypes": "News,Analysis,Case studies,Press releases"
  }
]
----

== See Also

link:/mule-user-guide/v/4.0/dataweave-types#functions-and-lambdas[Lambdas and Functions]

link:/mule-user-guide/v/4.0/dataweave-types[DataWeave Value Types]

link:/mule-user-guide/v/4.0/dataweave-operators[DataWeave Operators]

link:/mule-user-guide/v/4.0/dataweave-selectors[DataWeave Selectors]

link:/mule-user-guide/v/4.0/dataweave-examples[DataWeave Examples]
