= Example: Merging and Filtering Fields
:keywords: studio, anypoint, transform, transformer, format, aggregate, filter, json, metadata, dataweave, data weave, datamapper, dwl, dfl, dw, output structure, input structure, map, mapping, contains, as

This example merges data within `author` and `price` fields from an array of objects. Each object is uniquely identified by a `bookId` key.

It uses these operations:

* `map` goes through the fields within the first index of the payload's array (`payload[0]`).
* `using` and `filter` allow you to capture data from fields in objects that share the same `bookId` so you can merge the correct `author` fields from `payload[1]` into the output.

////
Note that the same DataWeave script can merge a collection of payloads that are grouped into a single Mule event. Such input can be produced with a Scatter-Gather component in your flow before the Transformer component.
////

.DataWeave
[source,DataWeave, linenums]
----
%dw 1.0
%output application/json
---

payload[0] map using (id = $.bookId) {
	bookId:	 	$.bookId,
  title:    $.title,
	price: 		$.price as Number,
	(payload[1] filter ($.*bookId contains id)  map {
		author:$.author
   })
}

----

.Input
[source,JSON, linenums]
----
{
  "Book Price by ID" : [
    {
      "bookId": 101,
      "title": "Some Book",
      "price" : 7.15
    },
    {
      "bookId": 102,
      "title": "Another Book",
      "price" : 40.75
    }],
  "Book Author by ID"  : [
    {
      "bookId": 101,
      "author"  : "Some Body"
    },
    {
      "bookId": 102,
      "author"  : "Some Body Else"
    }]
}
----

////
=== JSON Inputs for the Collection
.Input 1 for Collection - Payload[0]
[source, json, linenums]
----
[
  { "bookId":"101",
    "title":"world history",
    "price":"19.99"
  },
  {
    "bookId":"202",
    "title":"the great outdoors",
    "price":"15.99"
  }
]
----

.Input 2 for Collection - Payload[1]
[source, json, linenums]
----
[
  {
    "bookId":"101",
    "author":"john doe"
  },
  {
    "bookId":"202",
    "author":"jane doe"
  }
]
----
////

=== Output
.Output
[source, json, linenums]
----
[
  {
    "bookId": 101,
    "title": "Some Book",
    "price": 7.15,
    "author": "Some Body"
  },
  {
    "bookId": 102,
    "title": "Another Book",
    "price": 40.75,
    "author": "Some Body Else"
  }
]
----

////
Note that the *sample data* section of the Transform message component does not allow you to provide it a collection of multiple payloads as a sample. The only way to test this example is running it.
////

== See Also

link:/mule-user-guide/v/4.0/dataweave-operators[DataWeave Operators]
