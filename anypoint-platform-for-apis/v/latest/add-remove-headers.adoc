= Add-Remove Header Policies
:keywords: header, policy

Anypoint Platform for APIs supports several policies for injecting or removing headers from a request. The policies take effect before sending the request to the backend service, and before sending the response to the client after receiving the response of the backend service. The add request/response policies are depicted in this diagram:

image:gw-add-rem-header-diag.png[gw-add-rem-header-diag]

The remove request/response policies are depicted in this diagram:

image:gw-add-rem-header-diag.png[gw-add-resp-header-diag]

The following table describes each policy and shows an example of how to use the policy.

[width="100%",cols="33a,33a,34a",options="header"]
|===
| Policy Name | Description | Policy Usage Example
| Add Request Headers | Injects one or more headers into a request from the client to the backend service, or overrides the value of an existing header. | Run `curl http://localhost:8081 -H "extra-header:myvalue" -vvv` where extra-header is a configured header name and myvalue is the configured header value to add. Backend service log shows additions received.
| Remove Request Headers | Prevents receipt of one or more specified headers sent from the client to the backend service.  | Run `curl http://localhost:8081 -H "console:hello" -vvv` where console is the configured name of the header to exclude. Backend service log shows exclusions are not received.
| Add Response Headers | Injects one or more headers to a response from the backend service to the client, or overrides the header value in a response from the backend service. | `curl http://localhost:8081 -vvv` returns a response on the client command line that includes the additional header or shows the overriding value.
| Remove Response Headers | Prevents inclusion of one or more specified headers in a response from the backend service to the client. | `curl http://localhost:8081 -vvv` returns a response on the client command line that excludes a header.
|===

== Using Add-Remove Header Policies

The prerequisites for using Add-Remove Header policies, like other policies, on Anypoint Platform are:

* Set up an API Gateway development environment.
* Be an Organization Administrator or API Version Owner for an API version you want to manage on Anypoint Platform.

Applying policies is an API version management task. Currently, the Add-Remove Header policies are available on Exchange. Follow the step-by-step procedures to download, set up, and apply these policies.

=== Downloading Add-Remove Policies

. Login to Anypoint Platform and go to Exchange.
. Download the following policies:
+
* Add Request Headers Policy
+
* Remove Request Headers Policy
+
* Remove Response Headers Policy
+
* Add Response Headers Policy
+
. Unzip each policy archive.

=== Setting Up and Applying Add-Remove Policies
You configure the policies as custom policies. The following steps show how to set up and apply the policies on Anypoint Platform Cloud, assuming you set up a proxy.

. Select the version on API Administration page. For example, select the 1.0.development version of the T-Shirt Ordering Service.
. Click Manage CloudHub proxy.
. Start the application in CloudHub.
. Go back to API Administration page.
+
The Active indicator is on for the API you are managing.
+
. On the main menu drop-down, select Custom policies.
+
image:gw-custom-pol.png[gw-custom-pol]
+
The *Custom policies* page appears listing custom policies, if there are any, that are available for the API.
+
. Click *Add custom policy*.
. In Name, enter a name for the policy, for example `add request header policy`.
. In *Policy definition*, choose the downloaded YAML file, for example `add-request.yaml`.
. In *Policy configuration*, choose the downloaded XML file, for example, `add-request.xml`.
. Click *Add*.
+
image:gw-add-custom-pol.png[gw-add-custom-pol]
+
The policy appears on the *Custom policies* page.
image:gw-custom-pol-list.png[gw-custom-pol-list]

=== Applying the Add Request/Response Headers Policy

Continuing with example of the add request header policy, these steps apply the policy. You apply add response headers policies in the same manner.

. Select the version on API Administration page. For example, select the 1.0.development version of the T-Shirt Ordering Service.
. Scroll to the bottom of the version page and select Policies from the list of items.
+
The *add request header policy*, for example, appears in the *Available policies* list.
+
[WARNING]
If the header was already provided by the client/another policy, the value will be overwritten by the one you provide in this policy.
+
. Click *Apply*.
The *Apply add request header policy* dialog box appears.
. Type the name and value of a header. For example, type `extra-header` on the left and `myvalue` on the right.
+
image:gw-apply-add-req-head.png[gw-apply-add-req-head]
+
. Optionally, include expressions in the value of the header.
For example, include '#[message.inboundProperties['user-agent']]'` to substitute the name of the user-agent in the header text.
+
. Click image:gw-apply-pol-plus-icon.png[gw-apply-pol-plus-icon].
. Optionally add more names and values of headers to add in the same manner, and click *Apply*.
image:gw-apply-add-more.png[gw-apply-add-req-head]
+
The policy you applied moves from the *Available policies* list to the *Applied policies* list.

=== Applying the Remove Request/Response Headers Policy

You set up the remove request/response policies in the same way as you set up the request/response policies. The following steps show a slightly different process form removing request/response policies.

. Scroll to the bottom of the version page and select Policies from the list of items.
+
The *remove request header policy*, for example, appears in the *Available policies* list.
+
[WARNING]
If the header was already provided by the client/another policy, the value will be overwritten by the one you provide in this policy.
+
. Click *Apply*.
+
The *Apply remove request headers policy* dialog box appears.
+
. Type the name of each header that you want to remove, separated by commas.
+
image:gw-apply-rem-req-head.png[gw-apply-rem-req-head]
+
You can use wildcards to remove properties that have similar names. For example, using `foo-*`` will remove foo-bar, foo-test.
+
. Click *Apply*.
+
The policy you applied moves from the *Available policies* list to the *Applied policies* list.
