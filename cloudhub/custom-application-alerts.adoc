= Custom Application Alerts
:keywords: cloudhub, monitoring, api

Notifications give you visibility into business related events inside your application. For example, you can raise notifications when:

* Your application is unable to connect to a remote service
* An error occurs requiring human intervention, such as a problem with data mapping
* You want to create a summary of what occurred

In combination with link:/documentation/display/current/Alerts+and+Notifications[alerts], you can direct  notifications to different people to act on the alerts and fix the underlying problems.

This example illustrates:

* How to send business related events as notifications
* How to send errors as notifications
* How to send email alerts when notifications arrive

To create notifications from your application, install the https://www.mulesoft.com/exchange#!/cloudhub-integration-connector[CloudHub connector]. This connector allows you to create custom notifications inside your flows and inside your exception strategies. Anypoint Exchange leads you through the steps to install the connector.

image:/documentation/download/attachments/122752454/CloudHubConnector.png?version=2&modificationDate=1421884179104[image]

== Prerequisites

Before going further, complete the link:/documentation/display/current/Hello+World+on+CloudHub[Hello World] example as this information builds on top of it. In addition, "Mavenize" your project within Anypoint Studio. For more information, see link:/documentation/display/current/Using+Maven+with+Mule[Using Maven with Mule].

== CloudHub Connector

To add and configure the CloudHub connector to our previous flow for "Hello World":

. In Studio, find the *CloudHub* connector on the right menu and then drag and release it next to the *Set Payload* transformer:
+
image:/documentation/download/attachments/122752454/CHBasicFlow.png?version=1&modificationDate=1421950699858[image]
+
. Open the configuration for the CloudHub connector. Create a new *Config Reference* for the connector by clicking the plus sign (*+*):
+
image:/documentation/download/attachments/122752454/CHConnectorProperties.png?version=1&modificationDate=1421952352034[image]
+
. Enter your credentials into the configuration and click *OK*:
+
image:/documentation/download/attachments/122752454/CHConfigCreds.png?version=1&modificationDate=1421952162391[image]
+
. Set your properties making sure that you select the *Create notification* operation:
+
image:/documentation/download/attachments/122752454/CHConnectorSettings.png?version=1&modificationDate=1421953712999[image]

When your domain root is visited, the create-notification operation on the CloudHub connector creates a "Hello World!" notification message for the domain on which the application is currently running. When running on CloudHub, this connector authenticates automatically using a token from the environment so that it can be authenticated to post notifications to CloudHub. When running locally, this operation sends the message to the INFO log level.

[IMPORTANT]
If you  want to create notifications on CloudHub, even when running locally, you can use the `<create-notification/>`. This requires you to configure the connector with your username and password when running locally.

== Deploying Your Application

To deploy your application, right-click the *basic_tutorial* project, click *CloudHub*, and then click *Deploy to CloudHub*. Maven automatically handles the CloudHub dependencies for you.

== Triggering Your Notification

After your application is running, you can trigger the notification by simply going to your application's URL, for example: `http://YOURAPP.cloudhub.io/`. The page  displays a Hello World message, and automatically creates a new notification in your CloudHub console. Next, return to the CloudHub console and click the new notification indicator in the upper-right.

image:/documentation/download/attachments/122752454/CHAppsAndNotifications.png?version=1&modificationDate=1421973455658[image]

== Creating a Custom Alert

Alerts allow you to send emails based on your application notifications. To create a custom alert for your application notification, click your Hello World application, and then click *Alerts* from the left menu in the *New Alert* dialog, 

. Click *New alert*
. Enter an alert name, "Hello World"
. Optionally select your application name or leave the selection as "any"
. Select "custom application notification" as the event type
. Enter "Hello" as the text you want the notification to match
. Enter email addresses that you wish to email to
. Click *Create*
+
image:/documentation/download/attachments/122752454/image2014-10-24+19%3A14%3A23.png?version=1&modificationDate=1414203264307[image]
+
This creates your alert. Now, trigger your notification again by going to your application's URL, for example: http://YOURAPP.cloudhub.io/hello-notification[http://YOURAPP.cloudhub.io/]. You then receive an email with your notification in it!

== Creating a Notification Error

In addition to sending notifications from business events, you may want to send notifications when errors happen so they can be acted upon. To do this, you can use the CloudHub connector inside a catch exception strategy. To do this, add the following XML to your mule-config.xml file:

[source,xml]
----
<flow name="create notification from exception">
    <inbound-endpoint address="http://localhost:${http.port}/create-notification-from-exception"/>
    <scripting:component>
        <scripting:script engine="groovy">
            throw new Exception("Could not connect to remote service.")
        </scripting:script>
    </scripting:component>
    <default-exception-strategy>
        <cloudhub:create-notification message="Error processing transaction." priority="ERROR"/>
    </default-exception-strategy>
</flow>
----

This flow throws an exception and creates a notification from that exception with the message `Error processing transaction`. The exception stack trace for the flow is attached to the message. This can optionally be turned off using the `attachStacktrace` attribute.

As before:

. Build and deploy your application.
. Go to the URL: http://YOURAPP.cloudhub.io/create-notification-from-exception.
. Return to the CloudHub console, and a notification pop-up appears in the top-right.
. Click the notifications link, and the notification with the stack trace appears in the notifications list.
+
image:/documentation/download/attachments/122752454/notifications+-+exception.png?version=1&modificationDate=1414198435994[image]
+
. To view the whole stack trace and details, click *More* and the whole message appears in a pop-up window:
+
image:/documentation/download/attachments/122752454/notifications+-+stack+trace.png?version=1&modificationDate=1414198436006[image]
