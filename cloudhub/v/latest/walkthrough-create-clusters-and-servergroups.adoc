= Walkthrough Create Clusters and Server Groups
:keywords: cloudhub, cloud, api

image:cluster_high_level.png[diagram]

This document walks you through the steps needed to configure a server in the Runtime Manager, and then add it to a Cluster or a Server Group to then deploy apps to multiple servers.

To be able to walk through this scenario you must have the following:
* an Anypoint Platform account that enables you to use the runtime manager
* five servers on premises that match the link:/mule-user-guide/v/3.7/hardware-and-software-requirements[Hardware and Software Requirements] to run Mule ESB. None of these servers can belong to existing clusters or server groups.


-Description of Scenario + Purpose of it.

-Some preliminary - troubleshooting steps

when to use cluster / server group

The main difference between a cluster and a server group, is that a server group is stateless whilst a cluster does track server states. The servers in a cluster know what state the other servers are in, and so distribute the work load accordingly. Servers in a server group don't know what the rest of the machines are up to.


== Configure a Server

diagram

The steps below should be carried out for every server that you wish to use. In this walkthrough, we'll run these steps on five different servers.

. Download the latest version of Mule ESB and unzip it in your hard drive
. Download the compatible version of the link:/cloudhub/the-mule-agent[Mule Agent]
. Unzip the `mule-agent-[VERSION].zip` file to the `$MULE_HOME/bin` folder.

+
[NOTE]
If you happen to have a prior version of the agent installed and are prompted to rename or replace files, select `replace all`

. Open a command line, cd to your `$MULE_HOME/bin` folder and run `./amc_setup -U` to update the agent version. If you are using Windows, run: `amc_setup.bat -U` instead. For more details on how to install the Mule Agent, se link:/mule-agent/v/1.3.0/installing-mule-agent[Installing the Mule Agent].
. Log in to your account on the Anypoint Platform
. Navigate to Cloudhub and then the Servers tab, then click *Add Server*

+
image

. Click *Copy* to select the configuration

+
image

. Open a command line window. cd into the Mule `/bin` folder
. Paste the “configuration”

+
[NOTE]
Replace “server name” with a server name of your choice.

 then hit *Enter*

+
image

. At this point you should see a succes message. If you get any errors, check the troubleshooting section below

=== Troubleshooting

. Check to make sure your Mule instance on the server is running. Type `./mule` on the command line. If so, you should see a stream of messages

+
screenshot

. If so hit `Ctrl + C` to stop the process
. Verify that your Mule ESB version is compatible with the Mule Agent version you're using, check the compatibility matrix. If your versions are compatible, please contact support. If they aren't, please download the correct versions and follow the steps above once more.






== Set up a Cluster

image:create-cluster.png[create cluster]

. In the *Servers* tab, click *Crate Cluster*
. Select *Multicast*
(because bla bla)
. Select the servers you want to include in your cluster

+
image

+
[NOTE]
You can only select stand-alone servers (not part of a previous cluster/server group) that are online
. Click *Create Cluster*

+
image

. Wait for the servers to restart and come online again. You will be prompted with a success message

If you have already created a cluster and wish to add additional servers to it, follow the steps below:

. In the *Servers* tab, click on the cluster you wish to scale up
. On the side panel, click *Add Server*

+
image

. Select the server you wish to add
. Wait for the servers to restart and come online again. You will be prompted with a success message

== Deploy an app to a Cluster

image:deploy_to_cluster_diagram.png[deploy to cluster]

. Navigate to the *Applications* tab
. Click *Deploy* to deploy an application
. Assign a name to your application and select the target, in this case the cluster you created

+
image

. Click *Choose file* to select the application you will deploy

+
[NOTE]
The file you assign must be a Mule .zip file. See how to export these files from studio in link:i/mule-user-guide/v/3.7/importing-and-exporting-in-studio[Importing and Exporting in Studio].

. Your application should now be deployed and come online


== Set up a Server Group

image:create-server-group.png[server group]

. In the *Servers* tab, click *Crate Group*
. Select the servers you want to include in your group

+
image

+
[NOTE]
You can only select stand-alone servers (not part of a previous cluster/server group) that are online
. Click *Create Group*

+
image

. Wait for the success message



== Deploy an App to a Server Group

image:deploy_to_server_group_diagram.png[deploy to server group]

. Navigate to the *Applications* tab
. Click *Deploy* to deploy an application
. Assign a name to your application and select the target, in this case the server group you created
+
image

. Click *Choose file* to select the application you will deploy

+
[NOTE]
The file you assign must be a Mule .zip file. See how to export these files from studio in link:i/mule-user-guide/v/3.7/importing-and-exporting-in-studio[Importing and Exporting in Studio].

. Your application should now be deployed and come online

== Deploy an App to the Cloud
