= Transform Message Component
:keywords: studio, anypoint, esb, transform, transformer, format, aggregate, rename, split, filter convert, xml, json, csv, pojo, java object, metadata, dataweave, data weave, datamapper, dwl, dfl, dw, output structure, input structure, map, mapping


The Transform Message component carries out transformations over the input data it receives. You can explicitly write out a transformation in DataWeave language, or you can use the UI to build it implicitly through dragging and dropping elements.

The Transform Message component leverages metadata from connectors, schemas and sample data. It offers you a preview of your output that is built on sample data and is updated in real time as you make changes to your transformation.

You can work with two representations of the same transformation, and any changes done to one are matched in real time by the other:

* *Graphical View*: Two tree views show the known metadata structures of the input and output, mappings between these are represented through lines. These can be created through drag and drop.

+
image:dw-ui-side.png[ui]

* *Code View*: DataWeave code expresses the transformation in full depth, including functions that aggregate, normalize, group, join, partition, pivot and filter data.
+
image:dw-code-side.png[code]




[TIP]
====
If you have projects that are built with the deprecated link:/anypoint-studio/v/6/datamapper-user-guide-and-reference[DataMapper], a link:/mule-user-guide/v/3.8/dataweave-migrator[migrator tool] is included in Studio, which assists in converting a DataMapper map into DataWeave: Right click on a DataMapper, select *Migrate to DataWeave*, and follow the instructions.
====



== See Also

* See the link:/mule-user-guide/v/3.8/dataweave-language-introduction[DataWeave language introduction] for a guide on the DataWeave language syntax.

* Besides the *Transform Message Component* described in this document, you can also invoke DataWeave language on any Mule component that accepts link:/mule-user-guide/v/3.8/mule-expression-language-mel[Mule Expression Language (MEL)] by calling ti through a function. See link:/mule-user-guide/v/3.8/mel-dataweave-functions[MEL DataWeave Functions] for more information.




[TIP]
When creating a new transformation, it's a lot easier if you first add and configure any other elements on your flow that expose metadata. In this way, this metadata that other message processors expose to Studio is displayed in the input and output structures, without you needing to define the metadata explicitly.



= Workflow: Create a Mapping Through the UI




= Define Input and Output Structure (Anypoint Studio)

Many elements you can use in a Mule flow expose metadata about their input and output to the rest of the flow. For example, when a connector is configured to carry out a specific operation, its output structure is known, and this is expected to be the input received by the following component in the flow. When this information is available to the *Transform Message* component, it is interpreted as the expected input or the required output, depending on where each are placed relative to each other on the flow. This metadata is then displayed in the input or output structures in the UI.

Ideally you should have both the known input and the expected output as already defined. If the metadata definition is missing for the input or output, a notification on the corresponding pane of the Graphical UI will advise you to provide it. There are several ways you can deal with this:

* Make sure that other elements in the flow are fully configured. For example, a connector can't expose its output structure until a given operation is chosen, as its output might differ depending on this. A Web Service Consumer can include a WSDL file that describes the service, or an HTTP connector can include a link:https://raml.org/[RAML] API definition file.
* You can manually define the output of a Mule component via its *Metadata Tab*. See link:/anypoint-studio/v/6/defining-metadata[Defining Metadata].
* You can manually define the input of the Transform Message component by clicking on the *Define Metadata* link that appears in the notification that warns you about missing input metadata. See link:/anypoint-studio/v/6/defining-metadata[Defining Metadata].
+
[TIP]
This same menu can also be accessed by opening the <<The Preview Pane, preview pane>>, which will display a shortcut to set this up in case it's still not configured.

If a data type is already defined but you want to edit it, right-click on the root of the input or output tree and select *Set Metadata* to access the same options.

[TIP]
====
If you plan to create your transform entirely via the <<The DataWeave Text Editor, text editor pane>>, you can skip specifying the metadata definition and reference elements directly. You can set the output type in the link:/mule-user-guide/v/3.8/dataweave-language-introduction#output-directive[output directive] of your DataWeave code.

To define your metadata via XML, see link:/mule-user-guide/v/3.8/dataweave-xml-reference#defining-metadata-via-xml[DataWeave XML Reference].
====

== Reader Configuration

In case your input needs to be parsed in a special way, you can set up certain properties for the reader object. Each input format has different configurable properties, or none. There are two ways to set these:

* Configure other components on the flow, by accessing their link:/mule-user-guide/v/3.8/custom-metadata-tab[*Metadata* tab].

* On the Transform Message component, right click on the root of the input pane and select *Reader Configuration*
+
image:dw_reader_configuration_select.png[reader conf]

+
[NOTE]
This option only exists if the selected data type format allows for configurable reader properties. If the payload is of type `unknown`, you must change its type first.


You can also add this information through properties in the XML source of your Mule project. For this, see link:/mule-user-guide/v/3.8/dataweave-xml-reference#reader-proerties[DataWeave XML reference]


For a detailed reference of what properties can be set in the Reader Configuration of each format, see the corresponding *reader properties* section:

* link:/mule-user-guide/v/3.8/dataweave-formats#csv[CSV]

* link:/mule-user-guide/v/3.8/dataweave-formats#xml[XML]

* link:/mule-user-guide/v/3.8/dataweave-formats#flat-file[Flat File]

== Writer Configuration

In case your output needs to be constructed in a special way, you can set up certain properties of the writer object. Each output format has different configurable properties, or none.

These properties must be written on the `%output` directive of your DataWeave code.

For a detailed reference of what properties can be set in the Writer Configuration of each format, see the corresponding *reader properties* section:

* link:/mule-user-guide/v/3.8/dataweave-formats#csv[CSV]

* link:/mule-user-guide/v/3.8/dataweave-formats#xml[XML]

* link:/mule-user-guide/v/3.8/dataweave-formats#json[JSON]

* link:/mule-user-guide/v/3.8/dataweave-formats#flat-file[Flat File]



= Graphically Construct a Mapping (Anypoint Studio)

Through the graphical UI of the Transform Message component you can:

== Map a Field

Drag an element on the input structure over to another on the output structure. This will cast a line that joins them and also add the necessary lines to the DataWeave code that describes this mapping.

== Map a Structure

Drag a high-level object that contains inner fields inside it onto another in the output. You will be prompted about how to represent this in the DW code.
+
image:dw-complex-object-drag.png[complex object drag]

This creates a map (or mapObject???  statement)

== Set a Fixed Value

Double click on an output field to add it into the DataWeave code with a static value. This will add an `Fx` icon next to it, as well as a line to the DataWeave code that assigns a default `null` value to the field. You can then change this value in the code to whatever you want.
+
image:dw_click.png[click]

== Apply a Function

Double click on an output field to add it into the DataWeave code with a static value. This will add an `Fx` icon next to it, as well as a line to the DataWeave code that assigns a default `null` value to the field. You can then change this value in the code to whatever you want.
+
image:dw_click.png[click]

link to operators



[TIP]
====
Select an element to have its corresponding line in the DataWeave code highlighted. This is very helpful when dealing with large transforms.

If an input field is mapped to two or more output fields, you can right-click it and then select which of the multiple outputs you want to highlight in the DataWeave code.

Filter the views displayed in the input and output structures by typing a name in the search boxes at the top of either, only those fields that match your search are then displayed. This is particularly useful when dealing with large data structures with many nested elements.
====


////

=== Viewing Errors

For your DataWeave code's syntax to be evaluated, you must have the *Preview Pane* enabled. With this enabled, any syntax errors are marked. Above your DataWeave code, an additional error notification can be opened to display further detail.


image:dw_errors.png[errors]
If you click this notification, a window opens detailing each error in your code and its cause.


image:dw_errors2.png[errors]
////

== See Also

link:/mule-user-guide/v/3.8/dataweave-memory-management[DataWeave Memory Management].

= Preview the Output of a Transformation (Anypoint Studio)

You can provide sample input data to your Transform Message component to see how the transformation affects this. You don't need to deploy your project to see this. A sample output is updated in real time as you make changes both to the sample input and the transformation.


== Provide Input Sample Data

. Click on the root of the input pane and select *Edit Sample Data*.

image:dataweave-edit-sample-data.png[sample data]

. A new tab opens in the input pane with an empty scaffolding of your input structure. Values are populated with the string `????` as a placeholder.
. Replace these values with more useful sample values to see how they are mapped out to the preview pane.

image:dw-popupalte-sample-data.png[sample data]



[NOTE]
When the input is of type POJO, samples must be written in DataWeave format. This is not a transformation in itself, just a way to express how data is structured.

[TIP]
====
You can always click the *rescafold button* to restore the sample data to its default state. Note that with this you'll loose any sample data you've provided.

image:dw_rescafold-button.png[rescafold]
====

[TIP]
Make sure that you test your transformation for any special characters or structures that might arrive to it.

== The Preview Pane

Enable the preview pane by clicking on the *Preview* button on the top-right of the editor.

image:dw_buttons.png[buttons]

This pane presents a sample output, built by taking the sample input you provide and transforming it through the DataWeave transform. As you make changes in the DataWeave code, notice how the output data structure changes.  

If your transformer has <<Handling Multiple Outputs, multiple outputs>>, the *Preview* pane will display the one corresponding to the currently selected transform.

image:dw-sample-preview.png[preview]

[NOTE]
Note that samples defined in this pane work only within the *Transform Message* component, they don't alter the metadata that's propagated to other components in the flow, and their values aren't propagated onwards. They aren't used in your running application as default values nor in any other way.

If no sample is provided yet, this pane features a shortcut that you can click to open the <<provide input sample data,*Edit Sample*>> window and provide an input sample to construct the preview.

image:dw-create-sample-shortcut.png[shortuct]

If you still haven't set up the metadata structure for your input, when clicking on this shortcut you will be first prompted to set up the structure via the <<Defining Input and Output Structure>> window.


= Change the Target Output

By default, the Transform Message component outputs to the message payload. You can change this target, so that the result of your transformation populates another part of the output such as a property or variable.

. Click the *Edit Current Target* button image:using-dataweave-in-studio-47984.png[] above the DataWeave code editor.


. Specify where in the output Mule message to place the result of your DataWeave transform. In case you're creating a new variable or property, you must also set a name for it.

+
image:dw_new_variable.png[new variable]


= Handling Multiple Outputs


A single Transform Message component can give shape to several different parts of the output (example: the payload, a flow variable, a property). Each different output part must be defined in a separate DataWeave code, written out in a separate tab of the Transform pane. For example: if one tab defines the payload, and another an outbound property, these are both be parts of the same output Mule message.



To add a new output:


. Click the *Add new target* button image:using-dataweave-in-studio-34a3e.png[].


. Specify where in the output Mule message to place the result of this new DataWeave transform. In case you're creating a new variable or property, you must also set a name for it.

+
image:dw_new_variable.png[new variable]


[NOTE]
Execution order of multiple outputs may vary. Ensure each transformation is independent of the order of execution and the other outputs.

= Keep DataWeave Code in Separate Files



By default, DataWeave code is expressed inline within your Mule XML file. If you wish to keep it in a separate file and have your XML reference this file, you can generate a *`.dwl`* file (or several of them) to store your code. These files are packaged with your Mule application.

To export the DataWeave code to a .dwl file:


* click the *Edit Current Target* button
+
image:dw_multiple_outputs_edit.png[edit target]
* Select the 'File' radio button

+
image:dataweave-externalfile2.png[external file 2]

* Type a name for your `.dwl` file
* Click OK

A file is created under the 'src/main/resources' folder in your project containing your DataWeave code.




== See Also

* link:/mule-user-guide/v/3.8/dataweave-quickstart[DataWeave quickstart guide]
* View complete example projects that use DataWeave in the link:https://www.mulesoft.com/exchange#!/?filters=DataWeave&sortBy=rank[Anypoint Exchange]
* link:/mule-user-guide/v/3.8/dataweave-examples[DataWeave Examples]
* link:/mule-user-guide/v/3.8/dataweave-language-introduction[DataWeave Language Introduction]
* link:/mule-user-guide/v/3.8/dataweave-types[DataWeave Types]
* link:/mule-user-guide/v/3.8/dataweave-operators[DataWeave Operators]
* link:/mule-user-guide/v/3.8/mel-dataweave-functions[MEL DataWeave Functions]
