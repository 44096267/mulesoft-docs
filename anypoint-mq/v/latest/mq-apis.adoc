= Anypoint MQ APIs
:keywords: mq, destinations, queues, exchanges

The Anypoint MQ APIs let you use REST to send and receive messages, administer queues and exchanges, and analyze results.

Sign in with your Anypoint Platform username and password to use these portals. For access help, contact
link:https://www.mulesoft.com/support-and-services/mule-esb-support-license-subscription[MuleSoft Support].

Anypoint MQ portals are available in the link:https://anypoint.mulesoft.com/apiplatform/anypoint-platform/#/portals[Developer portal].

== Getting API Access Information

After you get an application's client ID and client secret from Anypoint Platform > *MQ*, you can run a *curl* command from a command line to get the bearer token, organization ID, and environment ID by using the Authorize resource. Once authorized, you can use the bearer token organization ID and environment ID in the rest of the calls.

To get API access information:

. Log into link:https://anypoint.mulesoft.com/#/signin[Anypoint Platform].
. Click *MQ*, *Client Apps*, and click the blue plus circle icon to create an app.
. Get the Client ID and Client Secret and plug these values into the *curl* command below replacing `myclientId` and `myclientSecret`:
+
[source]
----
curl -X POST -H "client_id: myclientId" -H "client_secret: myclientSecret" -H "grant_type: client_credentials" -H "Cache-Control: no-cache" -H "Content-Type: application/x-www-form-urlencoded" -d 'client_id={{client_id_broker}}&client_secret={{client_secret_broker}}&grant_type=client_credentials' "https://mq-us-east-1.anypoint.mulesoft.com/api/v1/authorize"`
----
+
. Submit the *curl* command.

Two other ways to view the Organization ID:

. View your Anypoint Platform profile JSON listing. First log in, and then copy and paste this address into your browser -- Line #4 shows your Organization ID value: link:https://anypoint.mulesoft.com/accounts/api/profile[https://anypoint.mulesoft.com/accounts/api/profile]
+
For example:
+
[source,xml,linenums]
----
},
  "organization": {
    "name": "memyself.andi",
    "id": "42d0gf0g-4254-4254-4254-425442544254",
    "createdAt": "2014-10-27T23:35:41.369Z",
    "updatedAt": "2016-01-22T14:59:53.397Z",
    "ownerId": "42544254-4254-4254-4254-425442544254",
    "clientId": "42424242424242424242424242424242",
    "domain": "memyselfandi",
    "idprovider_id": "example",
    "isFederated": false,
    "parentOrganizationIds": [],
    "subOrganizationIds": [],
    "tenantOrganizationIds": [],
    "isMaster": true,
    "subscription": {
      "type": "RocketScientist",
      "expiration": null
    },
----
+
. View the Organization ID and Environment ID from Anypoint Platform by clicking *Access Management* and getting the ID values from the URLs in the *Environments* and *Organization* sections.
+
*Environment ID*
+
image:mq-envid-from-url.png[mq-envid-from-url]
+
*Organization ID*
+
image:mq-get-orgid-from-url.png[mq-get-orgid-from-url]


== API Workflow

The following example with the Broker API illustrates the workflow for accessing an API:

image:mq-api-workflow.png[mq-api-workflow]

Steps:

. An application sends a request to Anypoint MQ and sets how long to hold the lock on the message.
. Anypoint MQ sends the message and the lock ID.
. The application acknowledges the message and requests Anypoint MQ to delete the message, or the application negatively acknowledges the message and requests Anypoint MQ to make the message available to other applications. The application sends the message ID and lock ID to Anypoint MQ. For additional information on setting automatic ack or nack, see the link:/anypoint-mq/mq-ack-mode[Acknowledgement Mode] guide.
. If no action is taken and the duration of the lock's time to live expires, the message is negatively acknowledged and returns to the queue to be available for other applications.

== Command Line Examples

The examples in this section use the link:https://anypoint.mulesoft.com/apiplatform/anypoint-platform/#/portals/organizations/68ef9520-24e9-4cf2-b2f5-620025690913/apis/25547/versions/27130[MQ Broker API] to publish and consume messages. You need to substitute the placeholder string, `42544254-4254-4254-4254-425442544254` for the proper values for authorization and token strings. These examples use Postman to access the queue.

The following *curl* command publishes a message:

[source,xml,linenums]
----
curl -X PUT -H "Content-Type: application/json" -H "Authorization: bearer 42544254-4254-4254-4254-425442544254" -H "Cache-Control: no-cache" -H "Postman-Token: 42544254-4254-4254-42544254-425442544254" -d '{
  "properties": {
    "userDefinedHeader": "User defined stuff",
    "anotherUserDefinedHeader": "Random stuff"
  },

  "body": "This is a message payload"
}
' "https://mq-qa-us-east-1.anypoint.mulesoft.com/api/v1/organizations/42544254-4254-4254-4254-425442544254/environments/42544254-4254-4254-4254-425442544254/destinations/postmanExchange/messages/552"
----

The following *curl* command gets a message:

[source,xml,linenums]
----
curl -X GET -H "Authorization: bearer 42544254-4254-4254-4254-425442544254" -H "Cache-Control: no-cache" -H "Postman-Token: 42544254-4254-4254-4254-425442544254" "https://mq-qa-us-east-1.anypoint.mulesoft.com/api/v1/organizations/42544254-4254-4254-4254-425442544254/environments/42544254-4254-4254-4254-425442544254/destinations/postmanQueue/messages?poolingTime=10000&batchSize=1&lockTtl=10000"
----

== Anypoint MQ Administration Portal

link:https://anypoint.mulesoft.com/apiplatform/anypoint-platform/#/portals/organizations/68ef9520-24e9-4cf2-b2f5-620025690913/apis/45045/versions/46698[Administration API] - Create and manage applications, queues, and exchanges.

link:https://anypoint.mulesoft.com/apiplatform/repository/v2/organizations/68ef9520-24e9-4cf2-b2f5-620025690913/public/apis/45045/versions/46698/files/export[Download the RAML specification].

image:mq-rest-admin-portal.png[mq-rest-admin-portal]

== Anypoint MQ Broker Portal

link:https://anypoint.mulesoft.com/apiplatform/anypoint-platform/#/portals/organizations/68ef9520-24e9-4cf2-b2f5-620025690913/apis/25547/versions/27130[Broker API] - Publish, consume, ack, and nack messages between queues and exchanges.

link:https://anypoint.mulesoft.com/apiplatform/repository/v2/organizations/68ef9520-24e9-4cf2-b2f5-620025690913/public/apis/25547/versions/27130/files/export[Download the RAML specification].

image:mq-rest-broker-portal.png[mq-rest-broker-portal]

== Anypoint MQ Statistics Portal

link:https://anypoint.mulesoft.com/apiplatform/anypoint-platform/#/portals/organizations/68ef9520-24e9-4cf2-b2f5-620025690913/apis/45827/versions/47525/pages/60090[Statistics API] - Perform statistical analysis of queue performance.

link:https://anypoint.mulesoft.com/apiplatform/repository/v2/organizations/68ef9520-24e9-4cf2-b2f5-620025690913/public/apis/45827/versions/47525/files/export[Download the RAML specification].

image:mq-rest-statistics-portal.png[mq-rest-statistics-portal]



== See Also

* link:/anypoint-mq/mq-tutorial[Tutorial]
* link:/anypoint-mq/mq-queues-and-exchanges[Create queues and exchanges, and send and receive messages]
* link:/anypoint-mq/mq-access-management[Set user or role MQ access permission]
* link:/anypoint-mq/mq-studio[Use Anypoint Studio with the MQ Connector]
* link:/anypoint-mq/mq-understanding[Understand MQ concepts]
* link:http://training.mulesoft.com[MuleSoft Training]
* link:https://www.mulesoft.com/webinars[MuleSoft Webinars]
* link:http://blogs.mulesoft.com[MuleSoft Blogs]
* link:http://forums.mulesoft.com[MuleSoft's Forums]
