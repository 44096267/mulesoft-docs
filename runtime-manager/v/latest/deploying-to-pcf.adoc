= Deploying to Pivotal Cloud Foundry
:keywords: cloudhub, cloud, deploy, manage, runtime manager, arm

image:logo-cloud-disabled.png[cloud]
image:logo-hybrid-disabled.png[hybrid]


[WARNING]
This deployment modality is currently in Beta.

If your local infrastructure includes Pivotal Cloud Foundry, you can deploy Mule applications to virtual servers running on dynamically allocated local resources. See link:/runtime-manager/deployment-strategies[Deployment Strategies] for a better understanding of how this works and its current limitations.





Through Pivotal Cloud Foundry, you can also deploy a proxy that can
link:




This page describes the options on the *Deploy Application* panel on the Runtime Manager UI.

////
[TIP]
====
Additionally, you can also deploy to CloudHub through:

* The *link:/runtime-manager/runtime-manager-api[Runtime Manager API]*
* The *link:/runtime-manager/anypoint-platform-cli[CloudHub Command Line Interface]*
====
////

[NOTE]
====
Deploying to PCF is only possible via the Anypoint Platform On-Premises Edition.

If you’re still interested in requesting the Anypoint Platform on-Premises Edition, please contact your sales representative.
====

== Accessing the Deploy Application Screen

To deploy an application:

. Sign in to the link:https://anypoint.mulesoft.com[Anypoint Platform] or click *Sign up* on the sign on page. 
. Hover your mouse over the *Runtime Manager* icon and click on it, or click *Open*
+
image::deploying-to-cloudhub-5f383.png[deploying-to-cloudhub-5f383]
+
. Click *Deploy application*:
+
image::deploying-to-cloudhub-3dcbb.png[deploying-to-cloudhub-3dcbb]
+
.  The Deploy Application page opens:
+
image::deploying-to-cloudhub-8524f.png[deploying-to-cloudhub-8524f]



////
=== From Anypoint Studio

You can easily deploy your applications to CloudHub, straight from Anypoint Studio. This is specially helpful if you're still developing the application and want to deploy it often to an online test environment.

. With your application open in Anpoint Studio as a Mule Project, Right-click on the project node in the package explorer. Then select *Deploy to Anypoint Platform* > *Cloud* from the cascading menu.
+
image:deploy+to+cloudhub.png[deploy+to+cloudhub]
+
. If this is your first time deploying in this way, a popup menu asks you to provide your login credentials for the Anypoint Platform. Studio stores your credentials and uses them automatically the next time you deploy to CloudHub.

+
[TIP]
You can manage these credentials through the Studio *Preferences* menu, in *Anypoint Studio* > *Authentication*.

. After you sign in, the Deploy Application menu opens.
+
image:DeployAppFirstScreen.png[DeployAppFirstScreen] 

[TIP]
For an example of deploying to CloudHub directly from Anypoint Studio, see link:/runtime-manager/hello-world-on-cloudhub[Hello World on CloudHub].
////


== Creating an Application Name

Every application requires a unique application domain name. The application domain identifies your application in the Runtime Manager.

In the *Deploy Application* dialog, enter a unique application name. Valid names contain alphanumeric characters and dashes, and contain at most 42 characters. If the name is valid, the Runtime Manager alerts you whether it is available or already reserved by another user.

image:DeployAppName.png[DeployAppName]


== Deployment Target

The *Deployment Target* field lets you specify where you want to deploy your application:

* On the Cloud Foundry
* On an on-premises server, server group, or cluster

This document focuses on deploying to the Cloud Foundry, for more information on deploying to servers, server groups and clusters, see link:/runtime-manager/deploying-to-your-own-servers[Deploying to Your Own Servers].

[NOTE]
If your Cloud Foundry is not properly configured yet....  this will take you to a link or something???









== Application File

Upload a new file for deployment. Click the *Choose file* button, select your application file, and then click *Open*.

*Note*: The application file size limit is 90 MB.

image:ApplicationFile.png[ApplicationFile]


== Application Configuration

=== Runtime Version

Using the drop-down menu, select the *Runtime version* to which you to deploy:

image:RuntimeVersion2.png[RuntimeVersion2]

[IMPORTANT]
====
* Ensure that the runtime version is the same Mule version used to develop your application. For example, if you use the value 3.5.0 and your application uses the new HTTP connector introduced in Mule 3.6 and newer, your application won't deploy and the log will contain errors.
* To see what runtime version you set when you deployed your application, click the *Applications* tab and click your application. In the expansion view on the right, click *Manage Application*. Click *Settings* to see the deployment values.
====

=== Replication Factor

Through this variable, you can set how many cores to use per application????


image:

all of your instances are accessed via a single load balancer that is automatically created by PCF and distributes the incoming traffic amongst them















== Properties Tab

You can also optionally specify properties that your application requires. This allows you to externalize important pieces of configuration which may switch depending on the environment in which you're deploying. For example, if you're using a Mule application in one environment, you might configure your database host to be localhost. But if you're using it on a different environment, you might configure it to be an Amazon RDS server.

To create an application property, click the *Properties* tab and set the variable by either using a text  `key=value` format or by using the list format with two text boxes. After you've made the change, click *Apply Changes*. 

image::deploying-to-cloudhub-cff02.png[]

These application properties can be used inside your Mule configuration. For example:

[source, xml, linenums]
----
<spring:bean id="jdbcDataSource" class="org.enhydra.jdbc.standard.StandardDataSource" destroy-method="shutdown">
   <spring:property name="driverName" value="com.mysql.jdbc.Driver"/>
   <spring:property name="url"value="${database.url}"/>
</spring:bean>
----

==== Overriding Properties

Just like with CloudHub and on-premise Mule runtime deployments, applications that you deploy to PCF can still bundle their own property placeholder or secure property placeholder files inside the deployable archive file. Mule substitutes these properties into the application when the application starts.

If you have any property names set in a mule-app.properties file inside your application or in bundled property placeholder files, then when your application is deployed, any entries in the Properties tab with the same name will override the matching value bundled with the application.

////
[Note]
It is possible to change the behavior of the application to not allow CloudHub properties to override properties bundled with the deployable archive. You do this by changing options in the Property Placeholder element in the Mule application. See link:http://docs.spring.io/spring/docs/current/javadoc-api/org/springframework/beans/factory/config/PropertyPlaceholderConfigurer.html[Spring documentation on Property Placeholder options] for more information on non-default property placeholder options.
////

////
==== Overriding Secure Properties

Note that you can flag application properties as secure so that their values are not visible to users at runtime or passed between the server and the console. You can also include an 'applications.properties' file in your application bundle, which can include properties that are marked as secure, and they will be automatically treated as such. These properties can also be overriden by new values you can set via the Runtime Manager console at runtime. See link:/runtime-manager/secure-application-properties[Secure Application Properties] for more information.
////


== Service Bindings Tab

On your Pivotal Operations Manager??  you can register different applications to make available as services. For example xx and xx

You can bind any of these so that  ....   ???









=== Properties for Service Bindings

Just as in the <<Properties Tab>>, you can define key:value pairs for properties that are specific to the corresponding service. Keep in mind that the properties on this tab will only act on the scope of the given service, whilst the properties on the *Properties Tab* will act at a global level over the full deployment.



== Deployment Execution

After you complete the above steps, click *Create* and PCF creates the necessary virtual resources, loads an image onto them that includes a Mule Runtime instance and then deploys your application to this Mule Runtime.







During this process, your view is switched to the log view allowing you to monitor the process of your application deployment. This process could take several minutes. During the deployment, the application status indicator changes to yellow to indicate deployment in progress.

When deployment is complete, the application status indicator changes to green and you are notified in the status area that the application has deployed successfully. Here's what is in the logs:

[source, code]
----
Successfully deployed [mule application name]
----

== Configuring a Deployed Application

Most of the settings discussed in the steps above can be edited once the application is already deployed. To do so you must:

. In the Applications tab, select an application entry and click *Manage Application*:
+
image:AMC_ManageApplication.png[AMC_ManageApplication] 
+
. Click the *Settings* tab:
+
image:ViewingDeployedApp.png[ViewingDeployedApp]




== Auto-Deploy a Proxy from API Manager


If you want to register an API in API Manager for an application that isn't developed as a Mule application, you can do this through the command line.

This creates a simple Mule application that works as a proxy, and that's automatically registered both in the Runtime Manager and in the API Manager. Through the API Manager, you can apply link:/anypoint-platform-for-apis/applying-runtime-policies[policies] and view usage data.

image:infrastructure-pcf-api.png[API PCF]


See link:/api-manager/setting-up-an-api-proxy[Setting Up a Proxy].

== Deployment Errors

If an error occurs and the application cannot be deployed, the application status indicator changes to red. You are alerted in the status area that an error occurred. Check the log details for any application deployment errors. You need to correct the error, upload the application, and deploy again.



== See Also



* link:/runtime-manager/managing-deployed-applications[Managing Deployed Applications] contains general information about hoy to manage your application once deployed
* link:/runtime-manager/managing-deployed-applications[Managing Deployed Applications] contains more information on how to manage your applications
* link:/runtime-manager/monitoring[Monitoring Applications] shows you how you can set up email alerts for whenever certain events occur with your application or workers
* For information on deploying to servers, server groups and clusters, see link:/runtime-manager/deploying-to-your-own-servers[Deploying to Your Own Servers].
