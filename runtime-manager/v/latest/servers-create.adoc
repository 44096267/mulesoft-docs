= To Create a Server

== Add a Server

The server communicates with Runtime Manager via an add-on to the Mule runtime called link:/runtime-manager/runtime-manager-agent[The Runtime Manager Agent]. In order to make a server visible in the Runtime Manager console and be able to manage it, you must first register it with the Runtime Manager Agent.

[NOTE]
====
*If the server you want to add is already registered with a different instance of Runtime Manager*, you won't be able to add it until you remove if from the other instance. To do this, <<Delete a Server, remove the server>> from the server list on the Runtime Manager console and then delete the 'mule-agent.yaml' configuration file found on your '{RUNTIME PARENT FOLDER}/conf' folder.

*If your environment requires all outbound calls to go through a proxy* you will need to modify the proxy settings in the 'wrapper.conf' file in the '{RUNTIME PARENT FOLDER}/conf' folder.

*If you're using Anypoint Platform Private Cloud Edition, ensure you have a supported version Runtime Manager agent installed.
====


=== Obtaining the Server Registration Token

To be able to run the command that registers your server with the Runtime Manager Agent, you must obtain the unique Token code for your particular instance of Runtime Manager and environment.

. Go to the *Servers* tab in Runtime Manager.
. Copy the full sample code that includes your unique token for your Runtime Manager account + environment. You will then run this code in a terminal in a further step.
** If you have not added any servers to the environment yet, you will see the sample displayed right away in this tab.

+
image:empty_servers-add_server_1st_srv-CORR.COMM-REAL-2.png[empty_servers-add_server_1st_srv-CORR.COMM-REAL-2]

** If the environment already contains servers, click *Add Server*. When you do this, you will see this same code that includes the token in it.


=== Run Command

. Run the displayed command (listed below) on each Mule server or API Gateway server, it contains information that is unique to your organization. Running this command enables the Mule server to communicate with Runtime Manager. The key included in the `-H` parameter (partly redacted in the image above) is a token generated specifically for your Mule server or API Gateway to authenticate against Runtime Manager.

To run this command:

.. In Runtime Manager, click *Copy* to copy the displayed command to your clipboard.
.. Open a terminal in the server where your Mule server or API Gateway resides.
.. Go to the `bin` directory inside the Mule server or API Gateway root directory.
.. Paste the command into your terminal.
.. Substitute the last parameter, `server-name`, with the name you want for your server. In the example below, the name is `srv1`.

+
[source,java, linenums]
----
./amc_setup -H 17958da2-[redacted]---1942 srv1
----

+
[TIP]
If running Windows, substitute `amc_setup.bat` for `./amc_setup` (without `./`).
+
.. Press Enter to run the command.
. Check that the command output on your terminal states that the credentials were extracted correctly
. In the *Servers* screen of Runtime Manager, you should see that your server (named `srv1` in this example) is listed as *Created*:
+
image:srv1_created.png[srv1_created]

[TIP]
If the server was running when registered, it needs to be restarted for it to start communicating with Runtime Manager.


==== About the amc_setup Command

The `amc_setup` command described above resides in `$MULE_HOME/bin`. If you do not run it from this directory, you have to either set the `MULE_HOME` environment variable before running the command, or use the `--mule-home` parameter:

[source,java, linenums]
----
/opt/mule-3.7.0/bin/amc_setup --mule-home /opt/mule-3.7.0 -H ...
----

The `amc_setup` script actually invokes the link:/runtime-manager/runtime-manager-agent[Runtime Manager Agent] installation script, which has several useful parameters for configuring security and proxies. For details on the options, see *Installation Options* in link:/runtime-manager/installing-and-configuring-mule-agent[installing and configuring Runtime Manager Agent].

==== About the Server Registration Token

The registration token provided by Runtime Manager (included in the command with the `-H` parameter) is specific to a single environment. For example, if you register a server in a QA environment by clicking *Add Server*, you get one token. However if you try to register into your *Production* environment by also clicking *Add Server*,  you get a different token. Tokens are specific to the environment in which you register a server. You can only copy and paste a token to register multiple Mules if you want all servers to be in the same environment.