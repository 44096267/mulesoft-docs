= To Read then Write Mapped Content to a File
:keywords: file, ftp, connector, operation
:toc:
:toc-title:

toc::[]

// For Anypoint Studio, Design Center: FTP connector

This example reads a JSON file from an FTP server, then writes a subset of that JSON content to a new file on the FTP server. The example uses DataWeave to map fields from the source file to fields in the destination file.

Recommended: To see the new JSON file on your FTP server, you can use a client FTP application, such as FileZilla.

. Provide a Polling trigger for your flow.
+
You do not need to change any settings.
+
. Set up a Read operation for the FTP connector:
.. Set up or select a configuration for the FTP connector.
+
You can set up an FTP or SFTP connection.
+
.. Provide the File Path to a JSON file.
+
Example: `full_record.json`
+
Assume that the JSON content has several records that look something like this:
+
----
[
  {
    "id": 1,
    "name": "Leanne Graham",
    "username": "Bret",
    "email": "Sincere@april.biz",
    "address": {
      "street": "Kulas Light",
      "suite": "Apt. 556",
      "city": "Gwenborough",
      "zipcode": "92998-3874",
      "geo": {
        "lat": "-37.3159",
        "lng": "81.1496"
      }
    },
    "phone": "1-770-736-8031 x56442",
    "website": "hildegard.org"
  },
  {
    "id": 2,
    "name": "Ervin Howell",
    "username": "Antonette",
    "email": "Shanna@melissa.tv",
    "address": {
      "street": "Victor Plains",
      "suite": "Suite 879",
      "city": "Wisokyburgh",
      "zipcode": "90566-7771",
      "geo": {
        "lat": "-43.9509",
        "lng": "-34.4618"
      }
    },
    "phone": "010-692-6593 x09125",
    "website": "anastasia.net"
  }
]
----
+
. After the Read operation, set up a Write operation for the FTP connector:
.. Continue to use the same FTP configuration that you used for the Read operation.
.. In the Write operation, provide a Path to a new JSON file.
+
Example: `partial_record.json`
+
. Click Map to open the Content window.
. In the Content window, select the Mapping tab at the bottom so that you can provide a mapping between the examples for the full record and a partial record.
+
.. For the Input, create a custom data type example that looks like this:
+
----
[
  {
    "id": 1,
    "name": "Leanne Graham",
    "username": "Bret",
    "email": "Sincere@april.biz",
    "address": {
      "street": "Kulas Light",
      "suite": "Apt. 556",
      "city": "Gwenborough",
      "zipcode": "92998-3874",
      "geo": {
        "lat": "-37.3159",
        "lng": "81.1496"
      }
    },
    "phone": "1-770-736-8031 x56442",
    "website": "hildegard.org"
  }
]
----
.. For the Output, create a custom data type that provides a subset of the full input example:
+
----
[
  {
    "id": 1,
    "name": "Leanne Graham",
    "username": "Bret",
    "email": "Sincere@april.biz",
    "website": "hildegard.org"
  }
]
----
.. Connect the Input fields to the Output fields.
+
Ignore all Input fields that do not have corresponding Output fields.
+
When you are done, your Preview should look like this:
+
----
{
  "id": 1,
  "name": "Leanne Graham",
  "username": "Bret",
  "email": "Sincere@april.biz",
  "website": "hildegard.org"
}
----
+
From the Source tab, your source should look like this:
+
----
%dw 1.0

%output application/java
---
(payload map (value0, index0) -> {
    "id": value0.id,
    "name": value0.name,
    "username": value0.username,
    "email": value0.email,
    "website": value0.website
  })
----
+
.. Close the Content window.
+
In the Write operation, the Content should match the content in the Source tab.
+
. Add a Logger to the end of your flow.
+
Message setting: `payload`
+
. Run your application.
. [Optional] Use an FTP client to see the new JSON file on your FTP server.
+
It should look something like this:
+
----
[
  {
    "id": 1,
    "name": "Leanne Graham",
    "username": "Bret",
    "email": "Sincere@april.biz",
    "website": "hildegard.org"
  },
  {
    "id": 2,
    "name": "Ervin Howell",
    "username": "Antonette",
    "email": "Shanna@melissa.tv",
    "website": "anastasia.net"
  }
]
----

[[see_also]]
== See Also

include::include_link_list.adoc[tags=ftp-set-up]

include::include_link_list.adoc[tags=sftp-set-up]

include::include_link_list.adoc[tags=read-file]

include::include_link_list.adoc[tags=write-to-file]

include::include_link_list.adoc[tags=ftp-connector]

include::include_link_list.adoc[tags=tech-ref-ftp]
