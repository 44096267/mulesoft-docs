= Example: To Store and Retrieve Information in an Object Store
:keywords: ObjectStore, store, retrieve
:toc:
:toc-title:

toc::[]

== Storing Information from the ObjectStore

You can use object store to store single values:

[source, xml]
----
<os:store key="userId" value="#[attributes.queryParams.id]" />
----

You can store complex structures that you build in line:

[source, xml, linenums]
----
<os:store key="state">
  <os:value>
    <![CDATA[#[
      output application/json
       ---
       {
          "id": attributes.queryParams.id,
          "timestamp": now(),
          "name": payload.name
        }
      ]]]>
  </os:value>
</os:store>
----


You can use this operation to store new values or update existing ones, depending on the value of the `failIfPresent` parameter. When this parameter is set to false (default value) then any pre-existing value associated to that key is  overwritten. If the parameter is set to true, then an `OS:KEY_ALREADY_EXISTS` error is thrown instead.

Another important consideration is regarding null values. It is not allowed to store a null value. 
However, a common use case is to obtain a value (most likely by evaluating an expression or transformation):

* Testing the value for not null
* Storing it if present
* Do nothing otherwise.

The `failOnNullValue` parameter simplifies this use case. On its default value of true, a `OS:NULL_VALUE` error is thrown if a null value is supplied. However, when set to false, a null value  causes this operation to do nothing: no error is raised but no value is altered either.

== Retrieving Information from the ObjectStore

Retrieves the value stored for the given key.

You can use it to retrieve single values:

[source, xml]
----
<os:retrieve key="userId" />
----

You can use this operation to provide default values when the key is not present in the store:

[source, xml, linenums]
----
<os:retrieve key="timestamp">
  <os:default-value>#[now()]</os:default-value>
</os:retrieve>
----

You can even have default complex structures:

[source, xml, linenums]
----
<os:retrieve key="state">
  <os:default-value>
    <![CDATA[#[
     output application/json
     ---
     {
        "id": attributes.queryParams.id,
        "timestamp": now(),
        "name": payload.name
      }
    ]]]>
  </os:default-value>
</os:retrieve>
----

To facilitate use cases in which no value exists for that key, behavior depends on the defaultValue parameter.

If the parameter was not provided or resolved to a null value, then an OS:KEY_NOT_FOUND error is thrown. Otherwise, the defaultValue is returned. However, this value is not stored.

[TIP]
All object store operations are synchronized at the key level. No other operation is able to access the same key, on the same object store while this operation is running. If the runtime is running on cluster mode, this synchronization is also guaranteed across nodes.
