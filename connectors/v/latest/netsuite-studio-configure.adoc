= To Configure the NetSuite Connecter in Studio 7

You can use this connector in Anypoint Studio by adding it as a dependency in your Mule application.

== Install Connector in Studio

. Open your Mule project in Anypoint Studio.
. Add the connector as a dependency in the pom.xml file:
+
[source, linenums]
----
<dependency>
  <groupId>org.mule.connectors</groupId>
  <artifactId>mule-netsuite-connector</artifactId>
  <version>8.0.0-001</version>
</dependency>
----

== Configure in Studio

. Drag and drop the connector to the Studio Canvas.
. Select an authentication mechanism from the Global connector configuration:
+
[%header%autowidth.spread]
|===
|Configuration |Description
|Login Authentication |Makes use of the SuiteTalk's login API call on the first request sent by the connector to establish a session with NetSuite.
|Request Based Authentication |Using this strategy, you can send user credentials in the SOAP header of each request instead of authenticating to NetSuite by invoking login.
|Single Sign-On Authentication |This is a token based authentication system that avoids the use of environment username and password. Here you supply a privateKey together with other information. The connector is then responsible for generating an authentication token and establishing a session with NetSuite via the `ssoLogin` API call on the first request.
|Token Authentication |Similar to Single Sign-On Login Authentication, this is a token based authentication system. However, instead of using a privateKey generated via openssl, this uses a consumer and token key/secret pairs which are established within the NetSuite environment.
|===
+
. Configure an authentication mechanism per the sections that follow.

=== Login Authentication

[%header%autowidth.spread]
|===
|Parameter |Description
|Name |Enter a name for the configuration with which to reference it later.
|Email |Enter the login email of the NetSuite user interface.
|Password |Enter the corresponding password to log into the NetSuite user interface.
|Account |Enter the account ID of the SuiteTalk NetSuite web services. This is usually found within NetSuite sandbox interface under Setup > Integration > Web Service Preferences.
|Role Id |Enter the role ID for the user in SuiteTalk, which determines the Processor privileges.
|Application Id |Enter the application ID corresponding to the Integration record to be used.
|===

=== Request Based Authentication

[%header%autowidth.spread]
|===
|Parameter |Description
|Name |Enter a name for the configuration with which to reference it later.
|Email |Enter the login email of the NetSuite userinterface.
|Password |Enter the corresponding password to log into NetSuite user interface.
|Account |Enter the account ID of the SuiteTalk NetSuite web services. This is usually found within NetSuite sandbox user interface under Setup > Integration > Web Service Preferences.
|Role Id |Enter the role ID for the user in SuiteTalk, which determines the Processor privileges.
|Application Id |Enter the application ID corresponding to the Integration record to be used.
|===

=== SSO Authentication

[%header%autowidth.spread]
|===
|Parameter |Description
|Name |Enter a name for the configuration so it can be referenced later.
|SSO Library | Add your SSO dependency as a maven dependency format once you click on 'Add dependency' button
|Partner Id |Enter the partner ID used in the mapping process.
|Partner Account |Enter the account ID of the SuiteTalk NetSuite web services.
|Company ID |Enter the company ID used in the mapping process for the connector to generate a token.
|User ID |Enter the user ID used in the mapping process for the connector to generate a token.
|Key File |Enter the privateKey file name to pick up from the project. This file should be the .der file generated as per NetSuiteâ€™s specifications. This is used to encrypt the company ID and user ID into a token for ssoLogin.
|Application Id |Enter the application ID corresponding to the Integration record to be used.
|===

=== Token Authentication


[%header%autowidth.spread]
|===
|Parameter |Description
|Consumer Key |Enter the consumer key value for the token based authentication enabled integration record being used.
|Consumer Secret |Enter the consumer secret value for the token based authentication enabled integration record being used.
|Token ID |Enter the token id representing the unique combination of a user and integration generated within the NetSuite environment.
|Token Secret |Enter the respective token secret for the user/integration pair.
|Account |Enter the account ID of the SuiteTalk NetSuite web services. This is usually found within NetSuite sandbox user interface under Setup > Integration > Web Service Preferences.
|Signature algorithm | Type of HMAC signature algorithm
|===

== Use Case: Studio

=== Add a New Employee Record

The current use case describes how to create a Mule application to add a new Employee record in NetSuite using Login Authentication.

image:netsuite_flow_add_record.png[Add Record Flow]

. Create a new Mule Project in Anypoint Studio.
. Create a new HTTP Listener global element configuration and leave it with the default values.
. Drag a HTTP endpoint onto the canvas and configure the following parameters:
+
[%header%autowidth.spread]
|===
|Parameter|Value
|Connector Configuration| HTTP_Listener_Configuration
|Path|/addEmployee
|===
+
. Create a new NetSuite: Login Authentication global element configuration and fill with environment values.
+
Click Test to confirm that Mule can connect with the NetSuite instance. If the connection is successful, click OK to save the configuration. Otherwise, review or correct any invalid parameters and test again.

. Select the NetSuite module and add addRecord operation next to the HTTP and in the Extension Configuration field select the configuration created in the previous section.
. Configure the operation with the following values:
+
[%header%autowidth.spread]
|===
|Parameter|Value
|Display Name |Add record (or any other name you prefer)
|Extension configuration |NetSuite_Config (name of the global element you have created)
|Record Type |EMPLOYEE
|===
+
. Drag a Transform Message component before the NetSuite connector, then click the component to open its properties editor. Once metadata has been retrieved, select the respective fields to populate for the Employee. The Transform script should look similar to the following:
+
[source,dataweave,linenums]
----
%dw 2.0
output application/java
---
{
	firstName: attributes.queryParams.firstName,
	lastName: attributes.queryParams.lastName,
    subsidiary: {
        internalId: attributes.queryParams.internalId
    } as Object {class: "org.mule.module.netsuite.extension.api.RecordRef"}
}
----
+
. Add a Transform Message right after the NetSuite endpoint to capture the response and configure it for transform Object to JSON values.
. Save and Run as Mule Application.
. To test the application:
.. From a web browser, enter the employee's internalId, fist name, and last name in the form of the following query parameters:
+
[source, xml]
----
http://localhost:8081/addEmployee?fistName=<FIRST_NAME>&lastname=<LAST_NAME>&name=<FIRST_NAME>&internalId=<INTERNAL_ID>
----
+
.. Mule conducts the query, and adds the Employee record to NetSuite.

== Use Case: XML

[source,xml,linenums]
----
<?xml version="1.0" encoding="UTF-8"?>
<mule xmlns="http://www.mulesoft.org/schema/mule/core" xmlns:doc="http://www.mulesoft.org/schema/mule/documentation" xmlns:ee="http://www.mulesoft.org/schema/mule/ee/core" xmlns:http="http://www.mulesoft.org/schema/mule/http" xmlns:netsuite="http://www.mulesoft.org/schema/mule/netsuite" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/current/mule.xsd http://www.mulesoft.org/schema/mule/http http://www.mulesoft.org/schema/mule/http/current/mule-http.xsd http://www.mulesoft.org/schema/mule/netsuite http://www.mulesoft.org/schema/mule/netsuite/current/mule-netsuite.xsd http://www.mulesoft.org/schema/mule/ee/core http://www.mulesoft.org/schema/mule/ee/core/current/mule-ee.xsd">
   <configuration-properties file="mule-app.properties" doc:name="Configuration properties" />
   <http:listener-config name="HTTP_Listener_config" doc:name="HTTP Listener config" doc:id="7ab4c27b-8bb3-4dc8-bb1c-7633518a5a3b">
      <http:listener-connection host="0.0.0.0" port="8081" />
   </http:listener-config>
   <netsuite:config name="NetSuite_Config" doc:name="NetSuite Config" doc:id="87f030c9-adb0-449b-83fe-024ab5144f1d">
      <netsuite:login-authentication-connection email="${netsuite.email}" password="${netsuite.password}" account="${netsuite.account}" roleId="${netsuite.roleid}" applicationId="${netsuite.applicationId}" />
   </netsuite:config>
   <flow name="testFlow" doc:id="1e5e1844-9cf3-4184-91f2-9aee21c0e4a2">
      <http:listener config-ref="HTTP_Listener_config" path="/addEmployee" doc:name="Listener" doc:id="e9c20950-b63a-471c-93cb-938200d72eeb" />
      <ee:transform doc:name="Transform Message" doc:id="11989e2b-67be-42f1-88b4-25c97757f28c">
         <ee:message>
            <ee:set-payload><![CDATA[%dw 2.0
output application/java
---
{
	firstName: attributes.queryParams.firstName,
	lastName: attributes.queryParams.lastName,
    subsidiary: {
        internalId: attributes.queryParams.internalId
    } as Object {class: "org.mule.module.netsuite.extension.api.RecordRef"}
}]]></ee:set-payload>
         </ee:message>
      </ee:transform>
      <netsuite:add-record config-ref="NetSuite_Config" doc:name="Add record" doc:id="bbbf6e3e-6ab7-454b-b5e1-3cdc944f8719" recordType="EMPLOYEE" />
      <ee:transform doc:name="Object to JSON" doc:id="5c5e8f91-6f44-413e-9c05-366109d4fed1">
         <ee:message>
            <ee:set-payload><![CDATA[%dw 2.0
output application/json
---
payload]]></ee:set-payload>
         </ee:message>
      </ee:transform>
   </flow>
</mule>
----

== Search Operation Tips

In NetSuite, the `search` operation can be used to execute a Basic Search, Joined Search or an Advanced Search. To this end, you need to instantiate one of these three search types for the record type you want to query:

[%header%autowidth.spread]
|===
|Search Type |Description
|`<Record>SearchBasic`|Used to execute a search on a record type based on search filter fields that are specific to that type.
|`<Record>Search`
|Used to execute a search on a record type based on search filter fields specific to that type and others that are associated with a related record type.
|`<Record>SearchAdvanced`
|Used to execute a search on a record type in which you specify search filter fields and/or search return columns or joined search columns. Using advanced search, you can also return an existing saved search.
|===

This also applies for the asynchronous equivalent of search, the `asyncSearch` operation.

=== ItemSearchAdvanced and ReturnSearchColumns

When searching the connector outputs a list of maps representing the Record objects returned by your `search` operation. If using an advanced search and the `returnSearchColumns` flag is set to true, NetSuite returns a `SearchRowList` containing the search results. The connector would then be responsible for mapping `SearchRows` into the corresponding `Record` type object in order to facilitate usability.

However, in the case of `ItemSearchAdvanced` the connector does not do this mapping and simply provides the user with the SearchRows. This is the case due to the fact that an ITEM in NetSuite can be of various types and cannot be assumed that the item type is an `ItemSearchRow`. This issue can also occur with any other record type that behaves similar to ITEM.

=== Entity Fields

[%header%autowidth.spread]
|===
|Record Type |Custom Field Placement
|CONTACT |Contact > customFieldList > customField
|CUSTOMER |Customer > customFieldList > customField
|EMPLOYEE |Employee > customFieldList > customField
|ENTITY_GROUP |EntityGroup > customFieldList > customField
|PARTNER |Partner > customFieldList > customField
|PROJECT_TASK |ProjectTask > customFieldList > customField
|VENDOR |Vendor > customFieldList > customField
|===

=== Item Fields

[%header%autowidth.spread]
|===
|Record Type |Custom Field Placement
|ASSEMBLY_ITEM |AssemblyItem > customFieldList > customField
|ENTITY_GROUP |EntityGroup > customFieldList > customField
|INVENTORY_ITEM |InventoryItem > customFieldList > customField
|KIT_ITEM |KitItem > customFieldList > customField
|NON_INVENTORY_PURCHASE_ITEM |NonInventoryPurchaseItem > customFieldList > customField
|NON_INVENTORY_RESALE_ITEM |NonInventoryResaleItem > customFieldList > customField
|NON_INVENTORY_SALE_ITEM |NonInventorySaleItem > customFieldList > customField
|OTHER_CHARGE_PURCHASE_ITEM |OtherChargePurchaseItem > customFieldList > customField
|OTHER_CHARGE_RESALE_ITEM |OtherChargeResaleItem > customFieldList > customField
|OTHER_CHARGE_SALE_ITEM |OtherChargeSaleItem > customFieldList > customField
|SERVICE_PURCHASE_ITEM |ServicePurchaseItem > customFieldList > customField
|SERVICE_RESALE_ITEM |ServiceResaleItem > customFieldList > customField
|SERVICE_SALE_ITEM |ServiceSaleItem > customFieldList > customField
|===

=== CRM Fields

[%header%autowidth.spread]
|===
|Record Type |Custom Field Placement
|CALENDAR_EVENT |CalendarEvent > customFieldList > customField
|CAMPAIGN |Campaign > customFieldList > customField
|ISSUE |Issue > customFieldList > customField
|MANUFACTURING_OPERATION_TASK |ManufacturingOperationTask > customFieldList > customField
|PHONE_CALL |PhoneCall > customFieldList > customField
|PROJECT_TASK |ProjectTask > customFieldList > customField
|SOLUTION |Solution > customFieldList > customField
|SUPPORT_CASE |SupportCase > customFieldList > customField
|TASK |Task > customFieldList > customField
|===

=== Transaction Body Fields

[%header%autowidth.spread]
|===
|Record Type |Custom Field Placement
|ASSEMBLY_BUILD |AssemblyBuild > customFieldList > customField
|CASH_SALE |CashSale > customFieldList > customField
|CUSTOMER_PAYMENT |CustomerPayment > customFieldList > customField
|DEPOSIT |Deposit > customFieldList > customField
|ESTIMATE |Estimate > customFieldList > customField
|EXPENSE_REPORT |ExpenseReport > customFieldList > customField
|INVENTORY_ADJUSTMENT |InventoryAdjustment > customFieldList > customField
|INVOICE |Invoice > customFieldList > customField
|ITEM_FULFILLMENT |ItemFulfillment > customFieldList > customField
|ITEM_RECEIPT |ItemReceipt > customFieldList > customField
|JOURNAL_ENTRY |JournalEntry > customFieldList > customField
|OPPORTUNITY |Opportunity > customFieldList > customField
|PURCHASE_ORDER |PurchaseOrder > customFieldList > customField
|PURCHASE_REQUISITION |PurchaseRequisition > customFieldList > customField
|SALES_ORDER |SalesOrder > customFieldList > customField
|TRANSFER_ORDER |TransferOrder > customFieldList > customField
|VENDOR_BILL |VendorBill > customFieldList > customField
|VENDOR_CREDIT |VendorCredit > customFieldList > customField
|VENDOR_PAYMENT |VendorPayment > customFieldList > customField
|VENDOR_RETURN_AUTHORIZATION |VendorReturnAuthorization > customFieldList > customField
|WORK_ORDER |WorkOrder > customFieldList > customField
|===

=== Transaction Column Fields

[%header%autowidth.spread]
|===
|Record Type |Custom Field Placement
|CASH_SALE |CashSale > itemList > item > customFieldList > customField
|ESTIMATE |Estimate > itemList > item > customFieldList > customField
|EXPENSE_REPORT |ExpenseReport > expenseList > expense > customFieldList > customField
|INVOICE |Invoice > itemList > item > customFieldList > customField
|ITEM_FULFILLMENT |ItemFulfillment > itemList > item > customFieldList > customField
|ITEM_RECEIPT |ItemReceipt > itemList > item > customFieldList > customField
|JOURNAL_ENTRY |JournalEntry > lineList > line > customFieldList > customField
|OPPORTUNITY |Opportunity > itemList > item > customFieldList > customField
|PURCHASE_ORDER |PurchaseOrder > itemList > item > customFieldList > customField
|PURCHASE_REQUISITION |PurchaseRequisition > itemList > item > customFieldList > customField
|SALES_ORDER |SalesOrder > itemList > item > customFieldList > customField
|TIME_BILL |TimeBill > customFieldList > customField
|TRANSFER_ORDER |TransferOrder > itemList > item > customFieldList > customField
|VENDOR_BILL |VendorBill > itemList > item > customFieldList > customField
|VENDOR_CREDIT |VendorCredit > itemList > item > customFieldList > customField
|VENDOR_PAYMENT |VendorPayment > itemList > item > customFieldList > customField
|VENDOR_RETURN_AUTHORIZATION |VendorReturnAuthorization > itemList > item > customFieldList > customField
|WORK_ORDER |WorkOrder > itemList > item > customFieldList > customField
|===

=== Other Custom Fields

[%header%autowidth.spread]
|===
|Record Type |Custom Field Placement
|ACCOUNT |Account > customFieldList > customField
|BIN |Bin > customFieldList > customField
|CLASSIFICATION |Classification > customFieldList > customField
|EXPENSE_CATEGORY |ExpenseCategory > customFieldList > customField
|ITEM_DEMAND_PLAN |ItemDemandPlan > customFieldList > customField
|ITEM_SUPPLY_PLAN |ItemSupplyPlan > customFieldList > customField
|LOCATION |Location > customFieldList > customField
|MANUFACTURING_COST_TEMPLATE |ManufacturingCostTemplate > customFieldList > customField
|MANUFACTURING_ROUTING |ManufacturingRouting > customFieldList > customField
|NOTE |Note > customFieldList > customField
|PROMOTION_CODE |PromotionCode > customFieldList > customField
|SUBSIDIARY |Subsidiary > customFieldList > customField
|===

== To Make RESTlet Calls

NetSuite RESTlets allow you to develop custom RESTful web services for your NetSuite account using JavaScript and SuiteScript.
The example calls a script deployed as a RESTlet via the GET method. Here, we are attempting to get the CUSTOMER record with id = 700 using the RESTlet with script = 546 and deploy = 1.

image:netsuite_flow_restlet_calls.png[RESTlet Calls Flow]

[source,xml,linenums]
----
<flow name="restletGet">
    <http:listener config-ref="HTTP_Listener_Configuration" path="/get" doc:name="/get"/>
    <dw:transform-message doc:name="Transform GET Input">
        <dw:set-payload><![CDATA[%dw 1.0
%output application/java
---
{
"id": "700",
"recordtype": "customer"
}]]></dw:set-payload>
    </dw:transform-message>
    <netsuite:call-restlet-get config-ref="NetSuite__Request_Level_Authentication" deploy="1" script="546" doc:name="NetSuite RESTlet (GET)"/>
    <json:object-to-json-transformer doc:name="Map to JSON"/>
    <logger level="INFO" doc:name="Logger"/>
</flow>
----

== To Use DataWeave

The NetSuite connectorâ€™s DataSense capability coupled with that of DataWeave via the Transform Message component makes integrating with your NetSuite environment straightforward. For the following two examples, we use a JSON input string and extract the necessary data from it to form our NetSuite request.

This example code adds a Journal Entry to NetSuite from the following JSON input:

[source,dataweave,linenums]
----
{
Â Â Â "tranId":"SampleJournal123",
Â Â Â "subsidiary":{
Â Â Â Â Â Â "internalId":"1"
Â Â Â },
Â Â Â "customFieldList":{
Â Â Â Â Â Â "customField":[
Â Â Â Â Â Â Â Â Â {
Â Â Â Â Â Â Â Â Â Â Â Â "StringCustomFieldRef__custbodytestbodyfield":"Sample Transaction Body Custom Field"
Â Â Â Â Â Â Â Â Â }
Â Â Â Â Â Â ]
Â Â Â },
Â Â Â "lineList":{
Â Â Â Â Â Â "line":[
Â Â Â Â Â Â Â Â Â {
Â Â Â Â Â Â Â Â Â Â Â Â "account":{
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â "internalId":"1"
Â Â Â Â Â Â Â Â Â Â Â Â },
Â Â Â Â Â Â Â Â Â Â Â Â "debit":100.0,
Â Â Â Â Â Â Â Â Â Â Â Â "customFieldList":{
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â "customField":[
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â "SelectCustomFieldRef__custcol_far_trn_relatedasset":{
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â "internalId":"1"
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â }
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â },
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â "StringCustomFieldRef__custcoltestcolumnfield": "Sample Transaction Column Custom Field 1"
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â }
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â ]
Â Â Â Â Â Â Â Â Â Â Â Â }
Â Â Â Â Â Â Â Â Â },
Â Â Â Â Â Â Â Â Â {
Â Â Â Â Â Â Â Â Â Â Â Â "account":{
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â "internalId":"1"
Â Â Â Â Â Â Â Â Â Â Â Â },
Â Â Â Â Â Â Â Â Â Â Â Â "credit":100.0,
Â Â Â Â Â Â Â Â Â Â Â Â "customFieldList":{
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â "customField":[
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â "SelectCustomFieldRef__custcol_far_trn_relatedasset":{
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â "internalId":"2"
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â }
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â },
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â {
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â "StringCustomFieldRef__custcoltestcolumnfield": "Sample Transaction Column Custom Field 2"
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â }
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â ]
Â Â Â Â Â Â Â Â Â Â Â Â }
Â Â Â Â Â Â Â Â Â }
Â Â Â Â Â Â ]
Â Â Â }
}
----


The "add operation for the connector expects a Map as input. Here is the DataWeave script to paste into the Transform Message DataWeave editor:

[source,dataweave,linenums]
----
%dw 1.0
%output application/java
---
{
	customFieldList: payload.customFieldList,
	lineList: payload.lineList,
	subsidiary: payload.subsidiary,
	tranId: payload.tranId
}
----

In this example, we use the same scenario for basic search as described in the previous section. However, instead of constructing the criteria in a java component, we transform a JSON string:


[source,dataweave,linenums]
----
{
Â Â Â "companyName": {
Â Â Â Â Â Â "operator": "STARTS_WITH",
Â Â Â Â Â Â "searchValue": "A"
Â Â Â },
Â Â Â "isPerson": false,
Â Â Â "priority": {
Â Â Â Â Â Â "operator": "EQUAL_TO",
Â Â Â Â Â Â "searchValue": 50
Â Â Â }
}
----

Here is the DataWeave script to paste into the Transform Message DataWeave editor:

[source,dataweave,linenums]
----
%dw 1.0
%output application/java
---
{
	customFieldList: {
		customField: [{
			scriptId: "custentity_cust_priority",
			operator: payload.priority.operator,
			searchValue: payload.priority.searchValue
		} as :object {
			class : "com.netsuite.webservices.platform.core.SearchLongCustomField"
		}]
	} as :object {
		class : "com.netsuite.webservices.platform.core.SearchCustomFieldList"
	},
	companyName: {
		operator: payload.companyName.operator,
		searchValue: payload.companyName.searchValue
	} as :object {
		class : "com.netsuite.webservices.platform.core.SearchStringField"
	},
	isPerson: {
		searchValue: payload.isPerson
	} as :object {
		class : "com.netsuite.webservices.platform.core.SearchBooleanField"
	}
} as :object {
	class : "com.netsuite.webservices.platform.common.CustomerSearchBasic"
}
----

== See Also

* Access the link:/connectors/netsuite-about[NetSuite connector].
