= To Query Data Dynamically (Design Center)

This procedure covers how to use a variable table name in the FROM clause and how to use an input parameter in the WHERE clause. For simplicity of the example, the variable value is hardcoded. In a real-world situation, instead of using a hardcoded value, you set up the following constructs and logic:

* A safe data source, such as a file, for the variable values
+
You store table names in a file instead of getting the name from user input because the latter invites SQL injection.
+
* Logic to retrieve variable values and construct the query using expressions

In this procedure, the first query selects data from the payments table, and the second query selects data from the customers table. In the WHERE clause, you use the safe :param syntax to prevent SQL injection. 

. Create a new project and in the new flow, select the HTTP Listener operation as the trigger. In the Listener configuration, accept an existing settings or make these changes:
+
* Protocol: Select HTTP.
* Host: *0.0.0.0*
* Port: *8081*
+
. In General, set Path to the path of the HTTP URL, for example, set Path to */*, and accept the other default Listener settings. Close the connector operation.
. Add the Transformer component to the flow, and hardcode a variable value to the name of the table you want to query:
+
* In Transform, on the Mappings tab, select Output Payload > Add Transformation.
+
* In Type, select Variable.
+
* In Name, enter a variable name, for example *cm_table*.
+
* Click Create.
+
* In the center of the Mappings pane, click Set Data Type.
+
* In Transform, in Data Type for Variables cm_table, select New Data Type.
+
* In Name, type a name, for example *tablename*.
+
* In Format, accept the default, JSON.
+
* In Type, select From Example and enter an example of a database name. For example, type the following string in quotation marks:
+
*"tablenamestring"*
+
*Apply Changes and then Keep Transformation.
* Double-click Variables String (Tablename):
+
image::hardcode-var.png[Variables String]
+
* Replace the curly brackets with the table name enclosed in parentheses. For example, type *"payments"*.
+
. Add a database connector Select operation to the flow, and set up the MySQL classicmodels database as described in "To Connect a Database."
. In Database - Select, in General, click image:function-key.png[f of x key]. 
+
In SQL Query Text, enter the concatenation operator, and an expression that represents the variable. For example:
+
*'SELECT * FROM ' ++ variables.cm_table ++ ' WHERE customerNumber = :cust_num'*
+
. In Input Parameters, enter the key, *cust_num* as value expression, *attributes.queryParams.cust_num*:
+
image::db-connector-sql-query-txt.png[select statement]
+
. Run the app:
+
* Click Deploy.
* Select Copy Link.
+
* Paste the link in a browser or client, such as Postman.
+
* To the URL, add an HTTP query parameter that sets the customer number. For example:
+
`+https://...cloudhub.io/?cust_num=103+`
+
The HTTP Listener hears the request, starts the app, and a file, which you can delete, containing the binary query results is downloaded from the browser to your localhost. 
+
. Open the database configuration and select Output.
+
The results of querying the payments table appear in JSON format.
+
. Simulate changing the cm_table variable programmatically: manually changing the value in the Transform component from *"payments"* to *"customers"* and run the query again.
+
`+https://...cloudhub.io/?cm_table=payments&cust_num=103+`
+
The results of querying the customers table appear when you select Output.

== See Also

* link:/connectors/db-filter-query-task[To Filter a Query Using an Input Parameter]
* link:/connectors/http-trigger-app-from-browser[To Start an App from a Browser]
* link:/connectors/db-connect-database-task[To Connect a Database]
* link:/connectors/db-connector-prevent-sql-injection-concept[About Preventing SQL Injection]
* link:http://www.mysqltutorial.org/download/2[Classic Models database download]
