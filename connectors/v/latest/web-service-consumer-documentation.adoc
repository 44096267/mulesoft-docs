= Web Service Consumer Connector Documentation Reference

Web Service Consumer extension used to consume SOAP web services.


== Parameters
[%header,cols="20a,80a"]
|===
|Name | Description
|Name | The name of this configuration. With this name can be later referenced.

Type: String +
Default: none + 
Required: yes
|Connection | The connection types that can be provided to this configuration. 

Type: <<config_connection, Connection>> +
Default: none + 
Required: yes
|===

== Connection Types

[[config_connection]]
=== Connection

ConnectionProvider that returns instances of SoapClient.

=== Parameters

[%header,cols="25a,75a"]
|===
|Name |Description
|WSDL Location |The WSDL file location's URL, which can be remote or local.

Type: String +
Default: none + 
Required: yes
|Service |The name of one of the services in the WSDL file. Defines the ports supported by the Web service. 

Type: String +
Default: none + 
Required: yes
|Port |The name of one of the Ports defined in the selected service. Defines the binding
Address.

Type: String +
Default: none + 
Required: yes
|Address |The address of the Web Service.

Type: String +
Default: none + 
Required: no
| SOAP Version |The soap version of the SOAP Web Service.

Enumeration, one of:

** SOAP11
** SOAP12

Type: String +
Default: SOAP11 + 
Required: no
|MTOM Enabled |Whether or not you should use the MTOM protocol to manage the attachments.

Type: Boolean +
Default: false + 
Required: no
|Encoding |Default character encoding to be used in all the messages. If not specified, uses the default character set in the Mule configuration.

Type: String +
Default: none + 
Required: no
|===

[%header,cols="30a,30a,40a"]
|===
|Item |Section |Description
|Custom Transport Configuration | <<http-transport-configuration>> |The transport configuration used to dispatch the SOAP messages.
|Sign Security Strategy | <<WssSignSecurityStrategy>> |Used to Sign the SOAP request that is being sent.
|Verify Signature Security Strategy | <<WssVerifySignatureSecurityStrategy>> |Used to Verify the signature of a SOAP response.
|Username Token Security Strategy | <<WssUsernameTokenSecurityStrategy>> |Provides the capability to authenticate using Username and Password with a SOAP service by adding the UsernameToken element in the SOAP request.
|Timestamp Security Strategy | <<WssTimestampSecurityStrategy>> |Bundles the outgoing SOAP message that it's being built with a timestamp that carries the creation.
|Decrypt Security Strategy | <<WssDecryptSecurityStrategy>> |Decrypts an encrypted SOAP response.
|Encrypt Security Strategy | <<WssEncryptSecurityStrategy>> |Encrypts the SOAP request.
|Reconnection Strategy | <<reconnect>>
<<reconnect-forever>> |  A retry strategy in case of connectivity errors
|Disable Validation | Boolean |  Disables connection validation
|Pooling Profile | <<PoolingProfile>> |  Characteristics of the connection pool
|===

== Custom Transport Configuration

The WSC dispatches the SOAP messages using HTTP by default, with a simple HTTP requester configuration. If you need it to instead run over a configuration of the connector that uses HTTPS (or an HTTP configuration that is different from the default) the Custom Transport Configuration lets the you specify a new HTTP configuration to use as underlying transport.

For example we can create a new HTTP configuration that hits an HTTP Basic Auth protected endpoint.

[source,xml,linenums]
----
<http:request-config name="authorized-requester">
   <http:request-connection host="localhost" port="8021" protocol="HTTP">
       <http:authentication>
           <http:basic-authentication username="AlejandroGamarra" password="m0zart"/>
       </http:authentication>
   </http:request-connection>
</http:request-config>
----

Then in the WSC configuration we specify the HTTP Requester config by its name.

[source,xml,linenums]
----
<wsc:config name="custom-config">
   <wsc:connection wsdlLocation="localwsdl/simple-service.wsdl" service="Service" port="Port">
       <wsc:custom-transport-configuration>
           <wsc:http-transport-configuration configName="authorized-requester"/>
       </wsc:custom-transport-configuration>
   </wsc:connection>
</wsc:config>
----

Now all requests made using the new "custom-config" WSC configuration are sent securely using the provided HTTP requester config.

=== Web Service Securities 

The WSC provides the capability to add WS-security for the outgoing and incoming soap messages, the supported security mechanisms that provides are:


* Username Token
* Timestamp
* Signature
* Verify Signature
* Encryption
* Decryption

=== UsernameToken

Adds a Username token to the outgoing soap message.

[source,xml,linenums]
----
<wsc:connection wsdlLocation="http://.../usernameToken?wsdl" service="Service" port="Port">
   <wsc:security-strategies>
       <wsc:wss-username-token-security-strategy 
		 username="admin" 
	     password="textPassword" 
	     passwordType="TEXT"
	     addCreated="true" 
	     addNonce="true"/>
   </wsc:security-strategies>
</wsc:connection>
----

== Web Service Consumer Operations

* <<consume>>

[[consume]]
== Consume
// wsc:consume


Consumes an operation from a SOAP Web Service.


=== Parameters

[%header,cols="25a,75a"]
|===
|Name |Description
|Configuration |The name of the configuration to use.

Type: String +
Default: none + 
Required: yes
|Operation |The name of the web service operation that aims to invoke.

Type: String +
Default: none + 
Required: yes
|Body |The XML body to include in the SOAP message, with all the required parameters, or null if no params are required.

Type: Binary +
Default: `#[payload]` + 
Required: no
|Headers |The XML headers to include in the SOAP message.

Type: Binary +
Default: none + 
Required: no
|Attachments |The attachments to include in the SOAP request.

Type: Object +
Default: none + 
Required: no
|Headers |A group of transport headers to bind with the transport request.

Type: Object +
Default: none + 
Required: no
|Target Variable |The name of a variable in which the operation's output is placed.

Type: String +
Default: none + 
Required: no
|===

=== Output

[cols="30a,70a"]
|===
| *Type* | Any
| *Attributes Type* | <<SoapAttributes>>
|===

==== For Configurations
* <<config>>

==== Throws
* WSC:INVALID_WSDL
* WSC:RETRY_EXHAUSTED
* WSC:BAD_REQUEST
* WSC:SOAP_FAULT
* WSC:TIMEOUT
* WSC:BAD_RESPONSE
* WSC:CANNOT_DISPATCH
* WSC:ENCODING
* WSC:CONNECTIVITY


== Types

[[WssSignSecurityStrategy]]
=== WSS Sign Security Strategy

[%header,cols=".^30%,.^40%,.^30%"]
|===
| Field | Type | Default Value
| Key Store Configuration a| <<wss-key-store-configuration>> | 
|===
    
[[wss-key-store-configuration]]
=== WSS Key Store Configuration

[%header,cols=".^30%,.^40%,.^30%"]
|===
| Field | Type | Default Value
| Alias a| String | 
| Key Password a| String | 
| Password a| String | 
| Key Store Path a| String | 
| Type a| String | jks
|===
    
[[WssVerifySignatureSecurityStrategy]]
=== WSS Verify Signature Security Strategy

[%header,cols=".^30%,.^40%,.^30%"]
|===
| Field | Type | Default Value
| Trust Store Configuration a| <<wss-trust-store-configuration>> | 
|===
    
[[wss-trust-store-configuration]]
=== WSS Trust Store Configuration

[%header,cols=".^30%,.^40%,.^30%"]
|===
| Field | Type | Default Value
| Trust Store Path a| String | 
| Password a| String | 
| Type a| String | jks
|===
    
[[WssUsernameTokenSecurityStrategy]]
=== WSS Username Token Security Strategy

[%header,cols=".^30%,.^40%,.^30%"]
|===
| Field | Type | Default Value
| Username a| String | 
| Password a| String | 
| Password Type a| Enumeration, one of:

** TEXT
** DIGEST | TEXT
| Add Nonce a| Boolean | false
| Add Created a| Boolean | false
|===
    
[[WssTimestampSecurityStrategy]]
=== WSS Timestamp Security Strategy

[%header,cols=".^30%,.^40%,.^30%"]
|===
| Field | Type | Default Value
| Time To Live a| Number | 60
| Time To Live Unit a| Enumeration, one of:

** NANOSECONDS
** MICROSECONDS
** MILLISECONDS
** SECONDS
** MINUTES
** HOURS
** DAYS | SECONDS
|===
    
[[WssDecryptSecurityStrategy]]
=== WSS Decrypt Security Strategy

[%header,cols=".^30%,.^40%,.^30%"]
|===
| Field | Type | Default Value
| Key Store Configuration a| <<wss-key-store-configuration>> | 
|===
    
[[WssEncryptSecurityStrategy]]
=== WSS Encrypt Security Strategy

[%header,cols=".^30%,.^40%,.^30%"]
|===
| Field | Type | Default Value
| Key Store Configuration a| <<wss-key-store-configuration>> | 
|===
    
[[reconnect]]
=== Reconnect

[%header,cols=".^30%,.^40%,.^30%"]
|===
| Field | Type | Default Value
| Frequency a| Number | 
| Count a| Number | 
| Blocking a| Boolean | 
|===
    
[[reconnect-forever]]
=== Reconnect Forever

[%header,cols=".^30%,.^40%,.^30%"]
|===
| Field | Type | Default Value
| Frequency a| Number | 
|===
    
[[PoolingProfile]]
=== Pooling Profile

[%header,cols=".^30%,.^40%,.^30%"]
|===
| Field | Type | Default Value
| Max Active a| Number | 
| Max Idle a| Number | 
| Max Wait a| Number | 
| Min Eviction Millis a| Number | 
| Eviction Check Interval Millis a| Number | 
| Exhausted Action a| Enumeration, one of:

** WHEN_EXHAUSTED_GROW
** WHEN_EXHAUSTED_WAIT
** WHEN_EXHAUSTED_FAIL | 
| Initialisation Policy a| Enumeration, one of:

** INITIALISE_NONE
** INITIALISE_ONE
** INITIALISE_ALL | 
| Disabled a| Boolean | 
|===
    
[[SoapAttributes]]
=== Soap Attributes

[%header,cols=".^30%,.^40%,.^30%"]
|===
| Field | Type | Default Value
| Protocol Headers a| Object | 
| Soap Headers a| Object | 
|===
    
[[http-transport-configuration]]
=== Http Transport Configuration

[%header,cols=".^30%,.^40%,.^30%"]
|===
| Field | Type | Default Value
| Config Name a| String | 
|===
    
