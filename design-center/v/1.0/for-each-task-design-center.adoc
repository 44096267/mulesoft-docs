= Drilling Down into a Nested JSON Object (Design Center)

This procedure describes how to use For Each to access one or more nested JSON elements in an object and iterate over the elements. You can process each element separately. For example purposes, this process uses a simple process, logging, to log each element separately along with the value of the counter. The element you want to log is _bs_ in the nested _company_ object of the JSONPlaceholder users data. Upon completion of the processing, original input to the flow is returned. This procedure logs the original input that the app returns.

You can process each element in a list, array, or map through a flow using For Each. To configure For Each, you use dot notation to specify the path to the nested JSON element you want to access. For example, to apply some processing to the entire _bs_ object nested in the _company_ object, you set the Collection field to payload.*company.bs`.

[source,JSON,linenums]
----
[
  {
    "id": 1,
    "name": "Leanne Graham",
    "username": "Bret",
     ...
      }
    },
    "phone": "1-770-736-8031 x56442",
    "website": "hildegard.org",
    "company": {
      "name": "Romaguera-Crona",
      "catchPhrase": "Multi-layered client-server neural-net",
      "bs": "harness real-time e-markets"
    }
  },
  ...
  }
]
----

Also, in the configuration, you use a default batch size of one. If a collection has 200 elements and you set the batch size to 50, for example, For Each iteratively processes 4 batches of 50 elements, returning separate results for each batch.

This procedure builds on the one to create a basic Mule app and to add an expression to make dynamic requests. After performing these procedures, you have HTTP listener and HTTP request in the Consume API flow, and you can perform the following steps to add For Each to the flow.

. Proceed to the next step if myproject is running. Otherwise, click Deploy. Execute the flow as follows:
+
* Click Copy Link.
+
* Paste the link in a browser or client, and type */getpath?path=users* at the end.
+
The HTTP Listener hears the request, and starts the app. The JSON Placeholder profile of each user appears in the browser. 
+
. In Design Center, add For Each after HTTP Request. Configure For Each as follows:
+
* In Collection, type the expression, using dot expression, to access the list, array, or map you want to iterate over . For example, type the following expression to access the _bs_ element in _company_:
*'payload.*company.bs'*
* In Batch Size, accept the default 1. 
* In Root Message Variable Name, accept the default.
* In Counter Variable Name, change the default to drillcounter just for example purposes.
+
image::foreach-configuration.png[]
+
. Close For Each
+
. Within the For Each scope, click image:arrange-cards-flow-design-center-e256e.png[add Logger] and add a Logger. Configure Logger as follows:
+
* In Message, click image:graphically-construct-mapping-design-center-task-8a822.png[].
* Type the following expression:
+
*payload ++ " count is: " ++ variables.drillcounter*
+
* Close the Logger.
. To the right of and outside of For Each, add another Logger. Configure Logger as follows:
+
* In Message, click image:graphically-construct-mapping-design-center-task-8a822.png[].
* Type the following expression:
+
*payload*
+
. Repeat step 1 to deploy and run the app, and then check the logs to see 10 messages, one for each iteration followed by the last message that contains the original input to the flow.
+
----
INFO15:34:35harness real-time e-markets count is: 1
INFO15:34:35synergize scalable supply-chains count is: 2
INFO15:34:35e-enable strategic applications count is: 3
INFO15:34:35transition cutting-edge web services count is: 4
INFO15:34:35revolutionize end-to-end systems count is: 5
INFO15:34:35e-enable innovative applications count is: 6
INFO15:34:35generate enterprise e-tailers count is: 7
INFO15:34:35e-enable extensible e-tailers count is: 8
INFO15:34:35aggregate real-time technologies count is: 9
INFO15:34:35target end-to-end models count is: 10
INFO15:34:35[{id=1, name=Leanne Graham, username=Bret, email=Sincere@april.biz, address={street=Kulas Light, ...
----


== See also

* link:/design-center/v/1.0/to-create-a-new-project[To Create a Basic Mule App]
* link:/design-center/v/1.0/design-dynamic-request-task[To Add an Expression for Dynamic Requests]
* link:https://mule4-docs.mulesoft.com/mule-user-guide/v/4.0/for-each-scope-concept[For Each Scope Concept]


