= APIkit Reference
:keywords: apikit, rest, console, load balancer, configuring path

APIkit supports RAML 1.0 and 0.8 versions as described in the release notes. APIkit projects can run onsite or on CloudHub. To get started using APIkit in Anypoint Studio, do one of the following:

* From Project Wizard import a RAML definition from one of the following sources:
** Local file system
** Anypoint Platform
** A remote location

* Create the RAML file within an existing Studio project (called a backend-first APIkit design).

When you import an API from Anypoint Platform, APIkit includes any RAML dependencies in the Studio project. 

APIkit generates the following things when you import or reference a RAML that declares a baseURI:

// Is Jetty supported?

* A main flow with an HTTP Listener
* An APIkit Router
* Error handling

[source,xml,linenums]
----
<flow name="api-main">

</flow>
----

Included in the project are backend flows containing REST resource-action mappings. You can simulate calls to the API using API Console.

After simulating calls to a RAML-based API using API Console, and improving or changing behavior, you alter the backend flows to act upon real resources with real data.

== Configuring the Path for Deployment on CloudHub

CloudHub requires a unique application name regardless of the region where you deploy the API. You can, for example, add the region name to the application name to ensure uniqueness. For example:

`test-customers-eu`

`test-customers-na`

By default, APIkit adds a base path `/api` to each API. The final URL of the APIs deployed on CloudHub is:

`+http://test-customers.eu.cloudhub.io/api/customers+`

`+http://acceptance-customer.eu.cloudhub.io/api/customers+`

== Changing APIkit Elements

Under the following conditions, you need to customize the mapping of RAML resources and actions:

* You generated backend flows as part of the backend-first design process.
* You renamed a backend flow.

Customizing the mapping of RAML resources and actions is described in the backend-first design process.

== Backend-First Design Process

If you create a new Studio project without specifying a RAML file, and you check the Add API Components checkbox, APIkit generates a skeletal RAML file and XML configuration that includes the following things:

* HTTP Listener configuration
* APIkit Router component
* Error handling flows

After adding the RAML content, you can use API Console to simulate the API.

=== Adding APIkit to an Existing Design

You add APIkit components to an existing design, for example a legacy project that you want to modernize using RAML and APIkit, by creating the RAML code within Studio as follows:

*RAML-based API*

* Define the RAML.
* Create a main flow, or use an existing one, that includes an HTTP Listener and APIkit Router.
* Generate backend flows.
* Add a reference to error handling in the main flow.
* Add an apikit:console component.

The generated backend flows contain the core logic of the API, the REST resource-action pairing.

=== Creating a Main Flow

Within the APIkit project, build a flow. Drag the following components from the Mule palette:

* An HTTP Listener
* An APIkit Router


=== Generating REST Backend Flows

When you create a RAML in Studio, generating backend flows is optional. Error handling is generated for a RAML-based API. You need to reference generated flows from the main flow. This procedure assumes you have already created a main flow.

To generate backend flows: 

. In the Package Explorer, right-click the project name.
. Select Mule > Generate Flows from RAML.
+
The backend flows appear below the main flow.

=== Mapping RAML Resources to Actions

As part of the backend-first design process, you map RAML resources to actions as shown in the following procedure. This procedure assumes you have generated backend flows.

To map resources to actions:

. Click the APIkit Router to open the *Properties Editor*. In *Router configuration*, click image:Add-16x16.png[].
+
The *Global Element Properties* wizard appears.
+
. Browse to the RAML file you created within Studio.
. In Mappings, click image:Add-16x16.png[] to create a new mapping.
+
The *New Mapping* dialog appears.
. Use the drop-down to map the resources to actions.
+
* In the Resource drop-down, select `/sales`.
+
* In the Action drop-down, select `Post`.
+
* In the Flow drop-down, select the flow that contains the post action.
+
Click *OK*.
+
image::apikit-using-ab251.png[apikit-using-ab251]
+
. Repeat the previous step for each resource-action pairing in the API.

== Using a Load Balancer

If your API implementation involves putting a load balancer in front of your APIkit application, configure the load balancer to redirect URLs that reference the `baseUri` of the application directly. If the load balancer does not redirect URLs, any calls that reach the load balancer looking for the application do not reach their destination. For example, you deploy an APIkit application to `myapp.mycompany.com`, and then add a load balancer at `www.exampleloadbalancer.com`. A call to the API arrives at `www.exampleloadbalancer.com` and the load balancer redirects the call to `myapp.mycompany.com` to get a response.

When using a load balance, set the `keepRamlBaseUri` to true to put the URL of a proxy in the baseUri property.

== See Also

* link:/apikit/apikit-tutorial-jsonplaceholder[REST tutorial]
* link:/release-notes/apikit-4.0-release-notes[Release Notes]
