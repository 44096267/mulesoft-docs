= Consuming a Web Service
:keywords: api, raml, json

Using Design Center, APIkit, and Anypoint Studio 7.0, you can build an interface based on RAML that connects to a free online REST service, link:http://jsonplaceholder.typicode.com[JSONPlaceholder].  Resources are:

 * All user information
 * Information about user having ID = _n_

The JSONPlaceholder service provides all the JSON user information. The RESTful API  navigates the JSON resource and filters user information.

== To Create the API Specification

. Download code for creating the RAML files from the "Download" section of this topic. Unzip the downloaded archive.
+
The following files are unpacked:
+
* api.raml
* user-example.json
+
. In Anypoint Platform, click Design Center, and in Projects click Create. In New Project, set up a project:
. In Project Name type a name for your new project. For example, type placeholder. In Project Type, select API Specification. The project opens for design in the master branch. 
. Select Files > Import. Import api.raml that you downloaded and delete placeholder.raml.
. Select Files > + > NewFile, select Other, and name the file user-example.json.
. Copy the code from user-example.json that you downloaded to the editor.
+
image::user-example-in-dc.png[raml example,height=289,width=678]

== To Create an APIkit Project that Uses the RAML

Next, you create an APIkit project in Studio using the RAML. 

== To Simulate calls to the API

, and satisfied that all is working as expected, you modify the project to use real data to consume the web service, filter the returned data using a parameter, and add a web service to filter the data to list an attribute from each record.

=== To Create the API Interface

link:/apikit/apikit-tutorial-jsonplaceholder#creating-the-raml[Creating the RAML] code for this interface is covered later. In this part of the tutorial, you use a provided RAML file to create the API interface to consume JSONPlaceholder web services:


. https://anypoint.mulesoft.com/apiplatform/[Sign into Anypoint Platform].
. link:/api-manager/creating-your-api-in-the-anypoint-platform#creating-an-api[Add an API] named jsonplaceholder to Anypoint Platform.
. link:/api-manager/designing-your-api#access-api-designer-from-anypoint-platform[In API Designer], copy/paste the contents of the downloaded api.raml.
. Click *Import* and import the `user-example.json` from the downloaded archive into API Designer. Save the file using the gear icon next to the file name.
. Select *Save All* from the Save drop-down.

=== Create an APIkit Project in Studio

To create an APIkit project in Studio to enhance the API:

. In Studio, create a new Mule project: *File* > *New* > *Mule Project*.
The New Mule Project dialog appears.
. In Project Settings, set the following options:
+
* *Project Name*: `myproject`
* *Runtime*: Select or accept the default `Mule Server 3.8.0 EE` or later.
* *Add APIkit components*: Check *Add APIkit components*.
* *API Definition*: Click the browse icon and select *API Platform*.
+
image::apikit-tutorial-jsonplaceholder-2de48.png[apikit-tutorial-jsonplaceholder-2de48,height=494,width=386]
+
Sign in. The *Browse API Manager for APIs* dialog appears listing the APIs in your Anypoint Platform Account.
. Select `jsonplaceholder` and click OK.
. Click *Finish*.
+
APIkit creates the following flows:
+
* link:/apikit/apikit-basic-anatomy#main-flow[api-main, the main flow]
* api-console, the APIkit Console flow for simulating calls to the API
* link:/apikit/apikit-basic-anatomy#backend-flows[backend flows] `get:/users/userbyid:api-config` and `get:/users:api-config`
* link:/apikit/apikit-basic-anatomy#raml-based-exception-strategy-mappings[Exception strategies flows]
+
. Right-click the API name `api.xml` and select *Run As* > *Mule Application*.
+
On the Console tab, messages indicate that the project is deployed, and the APIkit Console appears in the APIkit Console tab.

=== Simulate API Calls Using APIkit Console

link:/apikit/apikit-using#working-with-the-apikit-console[Use APIkit Console] to simulate calls to the API.

. On the /users resource *GET* tab, click *Try It*.
. Click *GET* to retrieve the RAML example in the `user-example.json` file.
+
Status 200 and the user 1 example appears:
+
----
[
  {
    "id": 1,
    "name": "Leanne Graham",
    "username": "Bret",
    "email": "Sincere@april.biz",
    "address": {
      "street": "Kulas Light",
      "suite": "Apt. 556",
      "city": "Gwenborough",
      "zipcode": "92998-3874",
      "geo": {
        "lat": "-37.3159",
        "lng": "81.1496"
      }
    },
    "phone": "1-770-736-8031 x56442",
    "website": "hildegard.org",
    "company": {
      "name": "Romaguera-Crona",
      "catchPhrase": "Multi-layered client-server neural-net",
      "bs": "harness real-time e-markets"
    }
  }
]
----
+
. On the /usersbyid resource *GET* tab, click *Try It*.
. Click *GET* to retrieve the RAML example for user 3 using the default parameter 3, as written in the RAML file.
+
----
 [{
 "id": 3,
 "name": "Clementine Bauch",
 "username": "Samantha",
 "email": "Nathan@yesenia.net",
 "address": {
   "street": "Douglas Extension",
   "suite": "Suite 847",
   "city": "McKenziehaven",
   "zipcode": "59590-4157",
   "geo": {
     "lat": "-68.6102",
     "lng": "-47.0653"
   }
 },
 "phone": "1-463-123-4447",
 "website": "ramiro.info",
 "company": {
   "name": "Romaguera-Jacobson",
   "catchPhrase": "Face to face bifurcated interface",
   "bs": "e-enable strategic applications"
 } }]
----

=== Modify the Project to Use Actual Data

After simulating calls to the API, prepare the API for publication. Modify and add flows that return actual data from the JSON Placeholder site instead of the data from RAML examples.

==== Modify the Users Flow to Consume a Web Service

To modify the users flow to get actual data from the Json Placeholder site:

. Select the `get:/users:api-config` flow.
. In the properties editor, in *Name*, rename the flow to `Users`.
. Drag an HTTP component to the Source section of the flow.
. In the properties editor of the HTTP Listener, change the *Path* from `/` to `/placeholder` and set *Allowed Methods* to GET.
. In Connector Configuration of the HTTP Listener, click image:Edit-16x16.gif[Edit-16x16] and click OK to accept the default host 0.0.0.0 and port 8081.
. Delete the Set Payload component from the Process area of the Users flow.
. Drag an HTTP connector to the Process area of the flow.
. In the properties editor of the HTTP Requester, set the following options:
+
* *Path*: `/users`
+
* *Method*: Select GET from the drop-down.
+
. In Connector Configuration of the HTTP Requester, click image:Add-16x16.png[Add-16x16].
+
The HTTP Request Configuration dialog appears.
+
. Set the following HTTP Request Configuration options:
+
* Accept the default *Name*, HTTP_Request_Configuration.
* Accept the default *HTTP* protocol.
* Set *Host* to jsonplaceholder.typicode.com.
* Set *Port* to 80.
+
. Click OK.
. Save changes.

==== Filter Users By ID Using a Parameter

Revise the flow to filter users by ID:

. Select the get:/users/userbyid:api-config flow.
. In the properties editor, in *Name* set the name to `UsersByID`.
. Drag an HTTP component to the Source section of the flow, and in the properties editor, set *Path* to `/placeholder/byid`.
. Delete *Set Payload* from the flow, and in its place, drag an HTTP component to the Process area.
. In the properties editor, set the following HTTP Requester options:
* *Path*: Set to `/users`.
* *Method*: Select GET from the drop-down.
* Click *Add Parameter* and set the following options:
+
** *Name* to `id`
** *Value* to `#[message.inboundProperties.'http.query.params'.id]`

== Add a Service to Get Names Only

To add a flow to filter users to get a list of user names:

. Copy and paste the Users flow to create another flow: Select the flow, and then *Edit* > *Copy*. Click a blank area of the canvas, and select *Edit* > *Paste*.
+
A copy of the Users flow appears at the bottom of the canvas.
+
. Select the `Copy_of_Users` flow, and in the properties editor, in *Name* change the flow name from `Copy_of_Users` to `UsersNames`.
. Select the HTTP listener component, and in the properties editor, change the *Path* from `/placeholder` to `/placeholder/names`.
. Drag a *Transform Message* component from the Mule palette to the right of the HTTP requester.
. In the properties editor, change the output code to specify the application/json mime type instead of application/java, and set the payload as follows:
+
----
%dw 1.0
%output application/json
---
  payload.name
----
+
. Save all.

== Test the API

. In Package Explorer, right-click the project name, and choose *Run As* > *Mule Application*.
. Open a browser, and go to `http://localhost:8081/placeholder`.
+
All user information from the JSONPlaceholder service appears:
+
----
[
   {
      "id": 1,
      "name": "Leanne Graham",
      "username": "Bret",
      "email": "Sincere@april.biz",
      "address": {
        "street": "Kulas Light",
        "suite": "Apt. 556",
        "city": "Gwenborough",
        "zipcode": "92998-3874",
        "geo": {
          "lat": "-37.3159",
          "lng": "81.1496"

    ...
    {
    "id": 10,
    "name": "Clementina DuBuque",
    "username": "Moriah.Stanton",
    "email": "Rey.Padberg@karina.biz",
    "address": {
      "street": "Kattie Turnpike",
      "suite": "Suite 198",
      "city": "Lebsackbury",
      "zipcode": "31428-2261",
      "geo": {
        "lat": "-38.2386",
        "lng": "57.2232"
      }
...
]
----
+
. Get user information about only the user having ID = 4. Go to `http://localhost:8081/placeholder/byid?id=4`.
+
----
[
  {
    "id": 4,
    "name": "Patricia Lebsack",
    "username": "Karianne",
    "email": "Julianne.OConner@kory.org",
    "address": {
      "street": "Hoeger Mall",
      "suite": "Apt. 692",
      "city": "South Elvis",
      "zipcode": "53919-4257",
      "geo": {
        "lat": "29.4572",
        "lng": "-164.2990"
      }
    },
    "phone": "493-170-9623 x156",
    "website": "kale.biz",
    "company": {
      "name": "Robel-Corkery",
      "catchPhrase": "Multi-tiered zero tolerance productivity",
      "bs": "transition cutting-edge web services"
    }
  }
]
----
+
. Get only the names of users. Go to `http://localhost:8081/placeholder/names`.
+
----
[
  "Leanne Graham",
  "Ervin Howell",
  "Clementine Bauch",
  "Patricia Lebsack",
  "Chelsey Dietrich",
  "Mrs. Dennis Schulist",
  "Kurtis Weissnat",
  "Nicholas Runolfsdottir V",
  "Glenna Reichert",
  "Clementina DuBuque"
]
----


The canvas after completing API interface contains these flows, stacked vertically. For example purposes, the flows are arranged to fit on the page.

image::apikit-tutorial-jsonplaceholder-7b245.png[apikit-tutorial-jsonplaceholder-7b245]

== Download

link:_attachments/apikit-tutorial2.zip[Download `apikit-tutorial2.zip`]

== See Also

* http://jsonplaceholder.typicode.com[JSONPlaceholder]
