= What's New in APIkit

If you're an APIkit 3.x user, you'll notice that APIKit preserves its behavior in APIkit 4.x Beta, but this version includes changes and improvements:

* APIkit error handling is aligned with Mule 4.0.
* Responses consist of auto-generated Dataweave code. (Enterprise Edition)
* APIkit is now a Mule plugin that you can update in a straightforward manner. 
+
The timing of future improvements and fixes are no longer constrained by Studio or Mule release schedules. 
+
* API Console UI has been improved and is now browser-based instead of being integrated in Studio. 
+
You can change APIkit Console URL by configuring an XML property. 
+
* The `apikit:config` properties have changed. New properties added are:
** outboundHeadersMapName
+
Supports sending custom headers with the response.
+
** httpStatusVarName
+
Supports storing the HTTP status code in a variable.

== Unified Error Handling

APIkit 4.0 replaces exception strategy and error mapping with the Mule 4 error handler. The error handler uses `on-error-propagate` types supported in Studio and other products to catch errors and define error messages:

[source,xml,linenums]
----
<apikit:router config-ref="api-config" />
<error-handler>
    <on-error-propagate type="APIKIT:BAD_REQUEST">
        <ee:transform xmlns:ee="http://www.mulesoft.org/schema/mule/ee/core" xsi:schemaLocation="http://www.mulesoft.org/schema/mule/ee/core http://www.mulesoft.org/schema/mule/ee/core/current/mule-ee.xsd">
            <ee:message>
                <ee:set-payload><![CDATA[%dw 2.0
output application/json
---
{message: "Bad request"}]]></ee:set-payload>
            </ee:message>
            <ee:variables>
                <ee:set-variable variableName="httpStatus">400</ee:set-variable>
            </ee:variables>
        </ee:transform>
    </on-error-propagate>
----

== Changing the API Console URL

In the api-console flow, you can modify the http:listener path property to change the URL from the default `+http://0.0.0.0:8081/console/+`.

[source,xml,linenums]
----
<flow name="api-console">
        <http:listener config-ref="api-httpListenerConfig" path="/console/*">
            ...
            </http:error-response>
        </http:listener>
        <apikit:console config-ref="api-config" />
----

== Execute non-functional requirements after the Router

By defining any message processor, execute non-functional requirements or quality attributes after the Router. You can add logs or traceability for all flows in one place.

== Adding a Header to a Response

Put the header you want to add inside a map.



== See Also

* link:/mule-user-guide/v/4.0/error-handling[Error Handling Reference]
* link:/apikit/apikit-simulate[To Simulate API Calls using API Console]
* https://raml.org/[RAML]
