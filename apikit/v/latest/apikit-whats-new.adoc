= What's New in APIkit

If you're an APIkit 3.x user, you'll notice a few changes and some significant improvements in APIkit 4.x for the Enterprise Edition:

* Error handling unified with Mule.
* Dataweave auto-generated code for responses. (Enterprise Edition) 
* Execution of non-functional requirements after the Router or quality attributes. For example, you can add logs or traceability for all flows.
* Distribution of APIkit as a plugin. MuleSoft can now release APIkit independently from Studio and Mule, and installation of fixes is straightforward. 
* A new APIkit Console, not embedded in Studio, that offers UI improvements and the capability to customize the endpoint. 
* Different apikit:config properties. New properties are:
** outboundHeadersMapName
** httpStatusVarName

== Error Handling Unified with Mule

APIkit 4.0 replaces exception strategy and error mapping with the Mule 4 error handler, which uses on-error-propagate types that catch errors and return error messages:

[source,xml,linenums]
----
        <apikit:router config-ref="api-config" />
        <error-handler>
            <on-error-propagate type="APIKIT:BAD_REQUEST">
                <ee:transform xmlns:ee="http://www.mulesoft.org/schema/mule/ee/core" xsi:schemaLocation="http://www.mulesoft.org/schema/mule/ee/core http://www.mulesoft.org/schema/mule/ee/core/current/mule-ee.xsd">
                    <ee:message>
                        <ee:set-payload><![CDATA[%dw 2.0
output application/json
---
{message: "Bad request"}]]></ee:set-payload>
                    </ee:message>
                    <ee:variables>
                        <ee:set-variable variableName="httpStatus">400</ee:set-variable>
                    </ee:variables>
                </ee:transform>
            </on-error-propagate>
----

== Enabling APIkit Console

TBD

== Execution of Requirements after Router Attributes

TBD

== Adding a Header to a Response

Put the header you want to add inside a map as shown in the following example:

TBD

APIkit uses DataWeave ...



== See Also

* link:/mule-user-guide/v/4.0/error-handling